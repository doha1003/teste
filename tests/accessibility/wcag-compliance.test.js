/**
 * WCAG 2.1 AA/AAA ì¤€ìˆ˜ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
 * ì›¹ ì ‘ê·¼ì„± ì§€ì¹¨ì„ ì¤€ìˆ˜í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
 */

import { test, expect } from '@playwright/test';
import { injectAxe, checkA11y, getViolations, reportViolations } from 'axe-playwright';

const TEST_PAGES = [
  { url: '/', name: 'Home Page' },
  { url: '/tests/mbti/', name: 'MBTI Test' },
  { url: '/tests/love-dna/', name: 'Love DNA Test' },
  { url: '/fortune/daily/', name: 'Daily Fortune' },
  { url: '/tools/bmi-calculator.html', name: 'BMI Calculator' },
  { url: '/about/', name: 'About Page' },
  { url: '/contact/', name: 'Contact Page' }
];

// WCAG 2.1 AA ê¸°ì¤€ ìƒ‰ìƒ ëŒ€ë¹„ ë¹„ìœ¨
const COLOR_CONTRAST_RATIOS = {
  normal: 4.5,    // ì¼ë°˜ í…ìŠ¤íŠ¸
  large: 3.0,     // í° í…ìŠ¤íŠ¸ (18pt ì´ìƒ ë˜ëŠ” 14pt bold ì´ìƒ)
  aaa_normal: 7.0,    // AAA ê¸°ì¤€ ì¼ë°˜ í…ìŠ¤íŠ¸
  aaa_large: 4.5      // AAA ê¸°ì¤€ í° í…ìŠ¤íŠ¸
};

test.describe('WCAG 2.1 ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸', () => {
  test.beforeEach(async ({ page }) => {\n    // axe-core ë¼ì´ë¸ŒëŸ¬ë¦¬ ì£¼ì…\n    await injectAxe(page);\n  });\n\n  // ê° í˜ì´ì§€ë³„ ì ‘ê·¼ì„± ê²€ì‚¬\n  for (const testPage of TEST_PAGES) {\n    test(`${testPage.name} - WCAG 2.1 AA ì¤€ìˆ˜ ê²€ì‚¬`, async ({ page }) => {\n      await page.goto(testPage.url);\n      \n      // í˜ì´ì§€ ë¡œë”© ì™„ë£Œ ëŒ€ê¸°\n      await page.waitForLoadState('networkidle');\n      \n      // axe-coreë¡œ ì ‘ê·¼ì„± ê²€ì‚¬ ì‹¤í–‰\n      await checkA11y(page, null, {\n        detailedReport: true,\n        detailedReportOptions: { html: true },\n        \n        // WCAG 2.1 AA ê¸°ì¤€ìœ¼ë¡œ ê²€ì‚¬\n        tags: ['wcag2a', 'wcag2aa', 'wcag21aa'],\n        \n        // ì‹¬ê°ë„ê°€ ë†’ì€ ìœ„ë°˜ì‚¬í•­ë§Œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ë¡œ ì²˜ë¦¬\n        impactLevels: ['critical', 'serious']\n      });\n      \n      console.log(`âœ“ ${testPage.name}: WCAG 2.1 AA ì¤€ìˆ˜`);\n    });\n\n    test(`${testPage.name} - WCAG 2.1 AAA ê²€ì‚¬ (ê²½ê³ )`, async ({ page }) => {\n      await page.goto(testPage.url);\n      await page.waitForLoadState('networkidle');\n      \n      try {\n        // AAA ê¸°ì¤€ìœ¼ë¡œ ê²€ì‚¬ (ì‹¤íŒ¨í•´ë„ í…ŒìŠ¤íŠ¸ëŠ” í†µê³¼)\n        const violations = await page.evaluate(() => {\n          return new Promise((resolve) => {\n            axe.run({\n              tags: ['wcag2aaa', 'wcag21aaa'],\n              runOnly: {\n                type: 'tag',\n                values: ['wcag2aaa', 'wcag21aaa']\n              }\n            }, (err, results) => {\n              if (err) resolve([]);\n              resolve(results.violations || []);\n            });\n          });\n        });\n        \n        if (violations.length > 0) {\n          console.warn(`âš ï¸  ${testPage.name}: ${violations.length}ê°œì˜ AAA ê¸°ì¤€ ê°œì„ ì‚¬í•­ ë°œê²¬`);\n          violations.forEach(violation => {\n            console.warn(`   - ${violation.description}`);\n          });\n        } else {\n          console.log(`ğŸ† ${testPage.name}: WCAG 2.1 AAA ì™„ì „ ì¤€ìˆ˜!`);\n        }\n      } catch (error) {\n        console.warn(`${testPage.name} AAA ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜:`, error.message);\n      }\n    });\n  }\n\n  test('ìƒ‰ìƒ ëŒ€ë¹„ ë¹„ìœ¨ ê²€ì¦', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n    \n    // í˜ì´ì§€ì˜ ëª¨ë“  í…ìŠ¤íŠ¸ ìš”ì†Œ ìƒ‰ìƒ ëŒ€ë¹„ ê²€ì‚¬\n    const contrastResults = await page.evaluate(() => {\n      const results = [];\n      \n      // ëª¨ë“  í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í¬í•¨í•œ ìš”ì†Œë“¤ ì°¾ê¸°\n      const textElements = document.querySelectorAll('*');\n      \n      textElements.forEach(element => {\n        const style = window.getComputedStyle(element);\n        const text = element.textContent?.trim();\n        \n        if (text && text.length > 0) {\n          const color = style.color;\n          const backgroundColor = style.backgroundColor;\n          const fontSize = parseFloat(style.fontSize);\n          const fontWeight = style.fontWeight;\n          \n          // í° í…ìŠ¤íŠ¸ ì—¬ë¶€ íŒë‹¨ (18pt = 24px, 14pt bold = 18.7px)\n          const isLargeText = fontSize >= 24 || (fontSize >= 18.7 && (fontWeight === 'bold' || parseInt(fontWeight) >= 700));\n          \n          results.push({\n            element: element.tagName.toLowerCase(),\n            text: text.substring(0, 50) + (text.length > 50 ? '...' : ''),\n            color,\n            backgroundColor,\n            fontSize,\n            fontWeight,\n            isLargeText\n          });\n        }\n      });\n      \n      return results.slice(0, 20); // ì²˜ìŒ 20ê°œë§Œ ê²€ì‚¬\n    });\n    \n    console.log(`ìƒ‰ìƒ ëŒ€ë¹„ ê²€ì‚¬ ëŒ€ìƒ: ${contrastResults.length}ê°œ ìš”ì†Œ`);\n    \n    // ê° í…ìŠ¤íŠ¸ ìš”ì†Œì˜ ìƒ‰ìƒ ëŒ€ë¹„ í™•ì¸\n    let contrastIssues = 0;\n    \n    for (const result of contrastResults) {\n      if (result.color === 'rgba(0, 0, 0, 0)' || result.backgroundColor === 'rgba(0, 0, 0, 0)') {\n        continue; // íˆ¬ëª…í•œ ìƒ‰ìƒì€ ê±´ë„ˆë›°ê¸°\n      }\n      \n      // ì‹¤ì œ ìƒ‰ìƒ ëŒ€ë¹„ ê³„ì‚°ì€ ë³µì¡í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ê¸°ë³¸ì ì¸ ê²€ì‚¬ë§Œ ìˆ˜í–‰\n      // ì‹¤ì œ í”„ë¡œë•ì…˜ì—ì„œëŠ” contrast ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ axe-core ê²°ê³¼ë¥¼ ì‚¬ìš©\n      \n      const isBlackOnWhite = result.color.includes('rgb(0, 0, 0)') && \n                            (result.backgroundColor.includes('rgb(255, 255, 255)') || \n                             result.backgroundColor === 'rgba(0, 0, 0, 0)');\n      \n      const isWhiteOnDark = result.color.includes('rgb(255, 255, 255)') && \n                           !result.backgroundColor.includes('rgb(255, 255, 255)');\n      \n      if (!isBlackOnWhite && !isWhiteOnDark && \n          !result.color.includes('rgb(51, 51, 51)') && // ì¼ë°˜ì ìœ¼ë¡œ ì¶©ë¶„í•œ ëŒ€ë¹„ë¥¼ ê°€ì§„ ì–´ë‘ìš´ íšŒìƒ‰\n          !result.color.includes('rgb(33, 37, 41)')) {  // Bootstrapì˜ ê¸°ë³¸ ë‹¤í¬ ìƒ‰ìƒ\n        contrastIssues++;\n        console.warn(`ìƒ‰ìƒ ëŒ€ë¹„ ê²€í†  í•„ìš”: ${result.element} - \"${result.text}\"`);\n        console.warn(`  ìƒ‰ìƒ: ${result.color}, ë°°ê²½: ${result.backgroundColor}`);\n      }\n    }\n    \n    // ì‹¬ê°í•œ ëŒ€ë¹„ ë¬¸ì œê°€ ì—†ì–´ì•¼ í•¨ (ì „ì²´ì˜ 10% ë¯¸ë§Œ)\n    expect(contrastIssues / contrastResults.length).toBeLessThan(0.1);\n  });\n\n  test('í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ ì™„ì „ì„± ê²€ì‚¬', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n    \n    // ëª¨ë“  ìƒí˜¸ì‘ìš© ê°€ëŠ¥í•œ ìš”ì†Œë“¤ ì°¾ê¸°\n    const interactiveElements = await page.evaluate(() => {\n      const selectors = [\n        'a[href]',\n        'button:not([disabled])',\n        'input:not([disabled])',\n        'select:not([disabled])',\n        'textarea:not([disabled])',\n        '[tabindex]:not([tabindex=\"-1\"])',\n        '[role=\"button\"]',\n        '[role=\"link\"]',\n        '[role=\"menuitem\"]',\n        '[role=\"tab\"]'\n      ];\n      \n      const elements = [];\n      selectors.forEach(selector => {\n        const found = document.querySelectorAll(selector);\n        found.forEach(el => {\n          if (el.offsetParent !== null) { // ë³´ì´ëŠ” ìš”ì†Œë§Œ\n            elements.push({\n              tagName: el.tagName.toLowerCase(),\n              type: el.type || null,\n              role: el.role || null,\n              tabIndex: el.tabIndex,\n              text: el.textContent?.trim().substring(0, 30) || '',\n              hasAriaLabel: !!el.getAttribute('aria-label'),\n              hasTitle: !!el.title\n            });\n          }\n        });\n      });\n      \n      return elements;\n    });\n    \n    console.log(`ìƒí˜¸ì‘ìš© ìš”ì†Œ ${interactiveElements.length}ê°œ ë°œê²¬`);\n    \n    // Tab í‚¤ë¡œ ìˆœíšŒ ê°€ëŠ¥í•œì§€ í™•ì¸\n    let focusableCount = 0;\n    let currentIndex = 0;\n    \n    while (currentIndex < Math.min(interactiveElements.length, 20) && focusableCount < 20) {\n      await page.keyboard.press('Tab');\n      \n      const focusedElement = await page.evaluate(() => {\n        const active = document.activeElement;\n        return active ? {\n          tagName: active.tagName.toLowerCase(),\n          text: active.textContent?.trim().substring(0, 30) || ''\n        } : null;\n      });\n      \n      if (focusedElement) {\n        focusableCount++;\n        console.log(`Tab ${focusableCount}: ${focusedElement.tagName} - \"${focusedElement.text}\"`);\n      }\n      \n      currentIndex++;\n      \n      // ë¬´í•œ ë£¨í”„ ë°©ì§€\n      if (currentIndex > 30) break;\n    }\n    \n    // ìµœì†Œí•œ ëª‡ ê°œì˜ ìš”ì†ŒëŠ” í¬ì»¤ìŠ¤ ê°€ëŠ¥í•´ì•¼ í•¨\n    expect(focusableCount).toBeGreaterThan(3);\n    \n    // í¬ì»¤ìŠ¤ íŠ¸ë© í™•ì¸ (ëª¨ë‹¬ì´ ìˆëŠ” ê²½ìš°)\n    const modalElements = await page.locator('[role=\"dialog\"], .modal').count();\n    if (modalElements > 0) {\n      console.log('ëª¨ë‹¬ ìš”ì†Œ ë°œê²¬ - í¬ì»¤ìŠ¤ íŠ¸ë© í™•ì¸ í•„ìš”');\n    }\n  });\n\n  test('ìŠ¤í¬ë¦° ë¦¬ë” í˜¸í™˜ì„± ê²€ì‚¬', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n    \n    // ARIA ë ˆì´ë¸”ê³¼ ì—­í•  ê²€ì‚¬\n    const ariaResults = await page.evaluate(() => {\n      const results = {\n        missingAltImages: [],\n        unlabeledInputs: [],\n        missingHeadingStructure: [],\n        missingLandmarks: [],\n        improperARIA: []\n      };\n      \n      // ì´ë¯¸ì§€ alt ì†ì„± ê²€ì‚¬\n      const images = document.querySelectorAll('img');\n      images.forEach((img, index) => {\n        if (!img.alt && img.alt !== '') {\n          results.missingAltImages.push({\n            src: img.src,\n            index\n          });\n        }\n      });\n      \n      // ì…ë ¥ í•„ë“œ ë ˆì´ë¸” ê²€ì‚¬\n      const inputs = document.querySelectorAll('input, select, textarea');\n      inputs.forEach((input, index) => {\n        const hasLabel = document.querySelector(`label[for=\"${input.id}\"]`) || \n                        input.getAttribute('aria-label') || \n                        input.getAttribute('aria-labelledby') ||\n                        input.getAttribute('title');\n        \n        if (!hasLabel && input.type !== 'hidden' && input.type !== 'submit' && input.type !== 'button') {\n          results.unlabeledInputs.push({\n            type: input.type,\n            name: input.name,\n            index\n          });\n        }\n      });\n      \n      // ì œëª© ê³„ì¸µêµ¬ì¡° ê²€ì‚¬\n      const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');\n      let previousLevel = 0;\n      headings.forEach((heading, index) => {\n        const level = parseInt(heading.tagName.charAt(1));\n        \n        if (index === 0 && level !== 1) {\n          results.missingHeadingStructure.push('ì²« ë²ˆì§¸ ì œëª©ì´ h1ì´ ì•„ë‹˜');\n        }\n        \n        if (level > previousLevel + 1) {\n          results.missingHeadingStructure.push(`h${previousLevel}ì—ì„œ h${level}ë¡œ ê±´ë„ˆëœ€`);\n        }\n        \n        previousLevel = level;\n      });\n      \n      // ëœë“œë§ˆí¬ ì—­í•  ê²€ì‚¬\n      const landmarks = {\n        main: document.querySelectorAll('main, [role=\"main\"]').length,\n        nav: document.querySelectorAll('nav, [role=\"navigation\"]').length,\n        header: document.querySelectorAll('header, [role=\"banner\"]').length,\n        footer: document.querySelectorAll('footer, [role=\"contentinfo\"]').length\n      };\n      \n      if (landmarks.main === 0) results.missingLandmarks.push('main');\n      if (landmarks.header === 0) results.missingLandmarks.push('header');\n      if (landmarks.footer === 0) results.missingLandmarks.push('footer');\n      \n      // ARIA ì†ì„± ìœ íš¨ì„± ê²€ì‚¬\n      const elementsWithAria = document.querySelectorAll('[aria-label], [aria-labelledby], [aria-describedby], [role]');\n      elementsWithAria.forEach((element, index) => {\n        const role = element.getAttribute('role');\n        const ariaLabel = element.getAttribute('aria-label');\n        const ariaLabelledby = element.getAttribute('aria-labelledby');\n        \n        // ë¹ˆ aria-label í™•ì¸\n        if (ariaLabel === '') {\n          results.improperARIA.push(`ë¹ˆ aria-label (ì¸ë±ìŠ¤: ${index})`);\n        }\n        \n        // aria-labelledbyê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì†Œë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ í™•ì¸\n        if (ariaLabelledby) {\n          const referenced = document.getElementById(ariaLabelledby);\n          if (!referenced) {\n            results.improperARIA.push(`ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìš”ì†Œ ì°¸ì¡°: ${ariaLabelledby}`);\n          }\n        }\n      });\n      \n      return results;\n    });\n    \n    // ê²°ê³¼ ê²€ì¦ ë° ë³´ê³ \n    console.log('ìŠ¤í¬ë¦° ë¦¬ë” í˜¸í™˜ì„± ê²€ì‚¬ ê²°ê³¼:');\n    \n    if (ariaResults.missingAltImages.length > 0) {\n      console.warn(`Alt ì†ì„± ëˆ„ë½ ì´ë¯¸ì§€: ${ariaResults.missingAltImages.length}ê°œ`);\n      // ì¤‘ìš”í•œ ì´ë¯¸ì§€ì˜ alt ì†ì„±ì€ í•„ìˆ˜\n      expect(ariaResults.missingAltImages.length).toBeLessThan(3);\n    }\n    \n    if (ariaResults.unlabeledInputs.length > 0) {\n      console.warn(`ë ˆì´ë¸” ëˆ„ë½ ì…ë ¥ í•„ë“œ: ${ariaResults.unlabeledInputs.length}ê°œ`);\n      // ëª¨ë“  ì…ë ¥ í•„ë“œëŠ” ë ˆì´ë¸”ì´ ìˆì–´ì•¼ í•¨\n      expect(ariaResults.unlabeledInputs.length).toBe(0);\n    }\n    \n    if (ariaResults.missingHeadingStructure.length > 0) {\n      console.warn('ì œëª© ê³„ì¸µêµ¬ì¡° ë¬¸ì œ:', ariaResults.missingHeadingStructure);\n      // ì œëª© êµ¬ì¡°ëŠ” ë…¼ë¦¬ì ì´ì–´ì•¼ í•¨\n      expect(ariaResults.missingHeadingStructure.length).toBeLessThan(2);\n    }\n    \n    if (ariaResults.missingLandmarks.length > 0) {\n      console.warn('ëˆ„ë½ëœ ëœë“œë§ˆí¬:', ariaResults.missingLandmarks);\n      // main ëœë“œë§ˆí¬ëŠ” í•„ìˆ˜\n      expect(ariaResults.missingLandmarks).not.toContain('main');\n    }\n    \n    if (ariaResults.improperARIA.length > 0) {\n      console.warn('ë¶€ì ì ˆí•œ ARIA ì‚¬ìš©:', ariaResults.improperARIA);\n      expect(ariaResults.improperARIA.length).toBe(0);\n    }\n    \n    console.log('âœ“ ìŠ¤í¬ë¦° ë¦¬ë” í˜¸í™˜ì„± ê²€ì‚¬ ì™„ë£Œ');\n  });\n\n  test('ëª¨ë°”ì¼ ì ‘ê·¼ì„± ê²€ì‚¬', async ({ page }) => {\n    // ëª¨ë°”ì¼ ë·°í¬íŠ¸ ì„¤ì •\n    await page.setViewportSize({ width: 375, height: 667 });\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n    \n    // í„°ì¹˜ íƒ€ê²Ÿ í¬ê¸° ê²€ì‚¬\n    const touchTargets = await page.evaluate(() => {\n      const interactiveElements = document.querySelectorAll(\n        'button, a, input, select, textarea, [role=\"button\"], [tabindex]:not([tabindex=\"-1\"])'\n      );\n      \n      const results = [];\n      interactiveElements.forEach((element, index) => {\n        if (element.offsetParent !== null) { // ë³´ì´ëŠ” ìš”ì†Œë§Œ\n          const rect = element.getBoundingClientRect();\n          results.push({\n            index,\n            tagName: element.tagName.toLowerCase(),\n            width: rect.width,\n            height: rect.height,\n            area: rect.width * rect.height,\n            text: element.textContent?.trim().substring(0, 20) || ''\n          });\n        }\n      });\n      \n      return results;\n    });\n    \n    console.log(`ëª¨ë°”ì¼ í„°ì¹˜ íƒ€ê²Ÿ ê²€ì‚¬: ${touchTargets.length}ê°œ ìš”ì†Œ`);\n    \n    let smallTargets = 0;\n    const minTouchSize = 44; // 44pxëŠ” WCAG ê¶Œì¥ ìµœì†Œ í„°ì¹˜ íƒ€ê²Ÿ í¬ê¸°\n    \n    touchTargets.forEach(target => {\n      if (target.width < minTouchSize || target.height < minTouchSize) {\n        smallTargets++;\n        console.warn(`ì‘ì€ í„°ì¹˜ íƒ€ê²Ÿ: ${target.tagName} \"${target.text}\" (${Math.round(target.width)}x${Math.round(target.height)}px)`);\n      }\n    });\n    \n    // 80% ì´ìƒì˜ í„°ì¹˜ íƒ€ê²Ÿì´ ì ì ˆí•œ í¬ê¸°ì—¬ì•¼ í•¨\n    const appropriateTargetRatio = (touchTargets.length - smallTargets) / touchTargets.length;\n    expect(appropriateTargetRatio).toBeGreaterThan(0.8);\n    \n    console.log(`ì ì ˆí•œ í¬ê¸°ì˜ í„°ì¹˜ íƒ€ê²Ÿ ë¹„ìœ¨: ${Math.round(appropriateTargetRatio * 100)}%`);\n    \n    // ë·°í¬íŠ¸ ë©”íƒ€ íƒœê·¸ í™•ì¸\n    const viewport = await page.locator('meta[name=\"viewport\"]').getAttribute('content');\n    expect(viewport).toBeTruthy();\n    expect(viewport).toContain('width=device-width');\n    \n    console.log('âœ“ ëª¨ë°”ì¼ ì ‘ê·¼ì„± ê²€ì‚¬ ì™„ë£Œ');\n  });\n\n  test('ë‹¤í¬ ëª¨ë“œ ì ‘ê·¼ì„± ê²€ì‚¬', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n    \n    // ë‹¤í¬ ëª¨ë“œ í™œì„±í™” (í…Œë§ˆ í† ê¸€ ë²„íŠ¼ì´ ìˆëŠ” ê²½ìš°)\n    const themeToggle = page.locator('.theme-toggle, .dark-mode-toggle, [data-theme-toggle]');\n    \n    if (await themeToggle.isVisible()) {\n      await themeToggle.click();\n      await page.waitForTimeout(500); // í…Œë§ˆ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ëŒ€ê¸°\n      \n      // ë‹¤í¬ ëª¨ë“œì—ì„œ ìƒ‰ìƒ ëŒ€ë¹„ ê²€ì‚¬\n      const darkModeViolations = await page.evaluate(() => {\n        return new Promise((resolve) => {\n          if (typeof axe !== 'undefined') {\n            axe.run({\n              rules: {\n                'color-contrast': { enabled: true }\n              }\n            }, (err, results) => {\n              if (err) resolve([]);\n              resolve(results.violations || []);\n            });\n          } else {\n            resolve([]);\n          }\n        });\n      });\n      \n      const contrastViolations = darkModeViolations.filter(v => v.id === 'color-contrast');\n      \n      if (contrastViolations.length > 0) {\n        console.warn(`ë‹¤í¬ ëª¨ë“œ ìƒ‰ìƒ ëŒ€ë¹„ ë¬¸ì œ: ${contrastViolations.length}ê°œ ë°œê²¬`);\n        contrastViolations.forEach(violation => {\n          console.warn(`  - ${violation.description}`);\n        });\n      } else {\n        console.log('âœ“ ë‹¤í¬ ëª¨ë“œ ìƒ‰ìƒ ëŒ€ë¹„ ì ì ˆí•¨');\n      }\n      \n      // ë‹¤í¬ ëª¨ë“œì—ì„œë„ ìƒ‰ìƒ ëŒ€ë¹„ ìœ„ë°˜ì‚¬í•­ì´ ì‹¬ê°í•˜ì§€ ì•Šì•„ì•¼ í•¨\n      expect(contrastViolations.length).toBeLessThan(5);\n      \n      // ë¼ì´íŠ¸ ëª¨ë“œë¡œ ë³µê·€\n      await themeToggle.click();\n      await page.waitForTimeout(500);\n    } else {\n      console.log('í…Œë§ˆ í† ê¸€ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ - ë‹¤í¬ ëª¨ë“œ í…ŒìŠ¤íŠ¸ ê±´ë„ˆëœ€');\n    }\n  });\n\n  test('í¼ ì ‘ê·¼ì„± ê²€ì‚¬', async ({ page }) => {\n    // í¼ì´ ìˆëŠ” í˜ì´ì§€ë¡œ ì´ë™\n    await page.goto('/contact/');\n    await page.waitForLoadState('networkidle');\n    \n    // í¼ ìš”ì†Œë“¤ì˜ ì ‘ê·¼ì„± ê²€ì‚¬\n    const formAccessibility = await page.evaluate(() => {\n      const results = {\n        formsWithFieldsets: 0,\n        formsWithLegends: 0,\n        inputsWithLabels: 0,\n        inputsWithoutLabels: 0,\n        inputsWithPlaceholderOnly: 0,\n        requiredFieldsWithAria: 0,\n        requiredFieldsWithoutAria: 0,\n        errorFieldsWithAria: 0\n      };\n      \n      // í¼ ê·¸ë£¹í™” ê²€ì‚¬\n      const forms = document.querySelectorAll('form');\n      forms.forEach(form => {\n        const fieldsets = form.querySelectorAll('fieldset');\n        const legends = form.querySelectorAll('legend');\n        \n        if (fieldsets.length > 0) results.formsWithFieldsets++;\n        if (legends.length > 0) results.formsWithLegends++;\n      });\n      \n      // ì…ë ¥ í•„ë“œ ë ˆì´ë¸” ê²€ì‚¬\n      const inputs = document.querySelectorAll('input:not([type=\"hidden\"]):not([type=\"submit\"]):not([type=\"button\"]), select, textarea');\n      inputs.forEach(input => {\n        const hasLabel = document.querySelector(`label[for=\"${input.id}\"]`) ||\n                        input.getAttribute('aria-label') ||\n                        input.getAttribute('aria-labelledby');\n        \n        const hasPlaceholder = input.placeholder;\n        const isRequired = input.required || input.getAttribute('aria-required') === 'true';\n        const hasError = input.getAttribute('aria-invalid') === 'true' ||\n                         input.getAttribute('aria-describedby');\n        \n        if (hasLabel) {\n          results.inputsWithLabels++;\n        } else {\n          results.inputsWithoutLabels++;\n          \n          if (hasPlaceholder && !hasLabel) {\n            results.inputsWithPlaceholderOnly++;\n          }\n        }\n        \n        if (isRequired) {\n          if (input.getAttribute('aria-required') === 'true' || input.required) {\n            results.requiredFieldsWithAria++;\n          } else {\n            results.requiredFieldsWithoutAria++;\n          }\n        }\n        \n        if (hasError) {\n          results.errorFieldsWithAria++;\n        }\n      });\n      \n      return results;\n    });\n    \n    console.log('í¼ ì ‘ê·¼ì„± ê²€ì‚¬ ê²°ê³¼:', formAccessibility);\n    \n    // ëª¨ë“  ì…ë ¥ í•„ë“œëŠ” ì ì ˆí•œ ë ˆì´ë¸”ì´ ìˆì–´ì•¼ í•¨\n    if (formAccessibility.inputsWithLabels + formAccessibility.inputsWithoutLabels > 0) {\n      const labeledRatio = formAccessibility.inputsWithLabels / \n                          (formAccessibility.inputsWithLabels + formAccessibility.inputsWithoutLabels);\n      expect(labeledRatio).toBeGreaterThan(0.9); // 90% ì´ìƒ\n    }\n    \n    // placeholderë§Œ ìˆëŠ” í•„ë“œëŠ” ì ‘ê·¼ì„± ë¬¸ì œ\n    expect(formAccessibility.inputsWithPlaceholderOnly).toBeLessThan(2);\n    \n    // í•„ìˆ˜ í•„ë“œëŠ” aria-required ì†ì„±ì´ ìˆì–´ì•¼ í•¨\n    if (formAccessibility.requiredFieldsWithAria + formAccessibility.requiredFieldsWithoutAria > 0) {\n      expect(formAccessibility.requiredFieldsWithoutAria).toBe(0);\n    }\n    \n    console.log('âœ“ í¼ ì ‘ê·¼ì„± ê²€ì‚¬ ì™„ë£Œ');\n  });\n\n  test('ë™ì  ì½˜í…ì¸  ì ‘ê·¼ì„± ê²€ì‚¬', async ({ page }) => {\n    await page.goto('/tests/mbti/');\n    await page.waitForLoadState('networkidle');\n    \n    // ë¼ì´ë¸Œ ë¦¬ì „ í™•ì¸\n    const liveRegions = await page.locator('[aria-live]').count();\n    console.log(`ë¼ì´ë¸Œ ë¦¬ì „ ${liveRegions}ê°œ ë°œê²¬`);\n    \n    // ë™ì  ì—…ë°ì´íŠ¸ê°€ ìˆëŠ” ìš”ì†Œë“¤ í™•ì¸\n    const dynamicElements = await page.evaluate(() => {\n      const results = [];\n      \n      // ì§„í–‰ë¥  í‘œì‹œê¸°\n      const progressBars = document.querySelectorAll('[role=\"progressbar\"], .progress');\n      progressBars.forEach(bar => {\n        results.push({\n          type: 'progressbar',\n          hasAriaValueNow: !!bar.getAttribute('aria-valuenow'),\n          hasAriaValueMax: !!bar.getAttribute('aria-valuemax'),\n          hasAriaLabel: !!bar.getAttribute('aria-label') || !!bar.getAttribute('aria-labelledby')\n        });\n      });\n      \n      // ê²½ê³ /ì•Œë¦¼ ë©”ì‹œì§€\n      const alerts = document.querySelectorAll('[role=\"alert\"], .alert, .error, .warning');\n      alerts.forEach(alert => {\n        results.push({\n          type: 'alert',\n          hasAriaLive: !!alert.getAttribute('aria-live'),\n          hasRole: !!alert.getAttribute('role')\n        });\n      });\n      \n      return results;\n    });\n    \n    // ì§„í–‰ë¥  í‘œì‹œê¸°ì˜ ì ‘ê·¼ì„± í™•ì¸\n    const progressBars = dynamicElements.filter(el => el.type === 'progressbar');\n    progressBars.forEach(bar => {\n      expect(bar.hasAriaValueNow).toBe(true);\n      expect(bar.hasAriaValueMax).toBe(true);\n    });\n    \n    // ê²½ê³  ë©”ì‹œì§€ì˜ ì ‘ê·¼ì„± í™•ì¸\n    const alerts = dynamicElements.filter(el => el.type === 'alert');\n    alerts.forEach(alert => {\n      expect(alert.hasAriaLive || alert.hasRole).toBe(true);\n    });\n    \n    console.log('âœ“ ë™ì  ì½˜í…ì¸  ì ‘ê·¼ì„± ê²€ì‚¬ ì™„ë£Œ');\n  });\n\n  test('ë‹¤êµ­ì–´ ì ‘ê·¼ì„± ê²€ì‚¬', async ({ page }) => {\n    await page.goto('/');\n    await page.waitForLoadState('networkidle');\n    \n    // ì–¸ì–´ ê´€ë ¨ ì†ì„± ê²€ì‚¬\n    const langResults = await page.evaluate(() => {\n      const results = {\n        htmlLang: document.documentElement.lang,\n        elementsWithLang: document.querySelectorAll('[lang]').length,\n        directionality: document.documentElement.dir || 'ltr'\n      };\n      \n      return results;\n    });\n    \n    console.log('ì–¸ì–´ ì ‘ê·¼ì„± ê²€ì‚¬ ê²°ê³¼:', langResults);\n    \n    // HTML ìš”ì†Œì— lang ì†ì„±ì´ ìˆì–´ì•¼ í•¨\n    expect(langResults.htmlLang).toBeTruthy();\n    expect(langResults.htmlLang).toBe('ko'); // í•œêµ­ì–´ ì‚¬ì´íŠ¸\n    \n    // í…ìŠ¤íŠ¸ ë°©í–¥ì„± í™•ì¸ (í•œêµ­ì–´ëŠ” LTR)\n    expect(langResults.directionality).toBe('ltr');\n    \n    console.log('âœ“ ë‹¤êµ­ì–´ ì ‘ê·¼ì„± ê²€ì‚¬ ì™„ë£Œ');\n  });\n});\n\n// ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸ ìƒì„±\ntest.afterAll(async () => {\n  console.log('\\n=== ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');\n  console.log('ëª¨ë“  WCAG 2.1 AA ê¸°ì¤€ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');\n  console.log('ì¶”ê°€ ê°œì„ ì‚¬í•­ì€ AAA ê¸°ì¤€ ê²½ê³  ë©”ì‹œì§€ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.');\n});"