name: ğŸ” QA ëª¨ë‹ˆí„°ë§ ë° ìë™í™”

on:
  schedule:
    # ë§¤ì¼ ìì • (KST) - UTC 15:00
    - cron: '0 15 * * *'
  
  # PR ìƒì„±/ì—…ë°ì´íŠ¸ ì‹œ ì„±ëŠ¥ íšŒê·€ í…ŒìŠ¤íŠ¸
  pull_request:
    branches: [ main, develop ]
    types: [opened, synchronize, reopened]
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:
    inputs:
      test_type:
        description: 'í…ŒìŠ¤íŠ¸ ìœ í˜• ì„ íƒ'
        required: true
        default: 'full'
        type: choice
        options:
          - full
          - performance
          - lighthouse
          - security
      
      lighthouse_threshold:
        description: 'Lighthouse ì ìˆ˜ ì„ê³„ê°’'
        required: false
        default: '85'
        type: string

env:
  NODE_VERSION: '18'
  SITE_URL: 'https://doha.kr'
  LIGHTHOUSE_THRESHOLD: ${{ github.event.inputs.lighthouse_threshold || '85' }}

jobs:
  # ì¼ì¼ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
  daily-performance-check:
    if: github.event_name == 'schedule' || (github.event_name == 'workflow_dispatch' && contains(github.event.inputs.test_type, 'performance'))
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸš€ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
      
      - name: ğŸ” ì‚¬ì´íŠ¸ ìƒíƒœ í™•ì¸
        run: |
          response=$(curl -s -o /dev/null -w "%{http_code}" ${{ env.SITE_URL }})
          if [ $response -ne 200 ]; then
            echo "âŒ ì‚¬ì´íŠ¸ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (HTTP $response)"
            exit 1
          fi
          echo "âœ… ì‚¬ì´íŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•©ë‹ˆë‹¤ (HTTP $response)"
      
      - name: ğŸ“Š Lighthouse ì„±ëŠ¥ ì¸¡ì •
        id: lighthouse
        run: |
          npx lighthouse ${{ env.SITE_URL }} \
            --preset=desktop \
            --chrome-flags="--headless --no-sandbox --disable-dev-shm-usage" \
            --output=json \
            --output-path=./lighthouse-report.json
          
          # ì„±ëŠ¥ ì ìˆ˜ ì¶”ì¶œ
          PERFORMANCE_SCORE=$(node -e "
            const report = require('./lighthouse-report.json');
            console.log(Math.round(report.lhr.categories.performance.score * 100));
          ")
          
          echo "performance_score=$PERFORMANCE_SCORE" >> $GITHUB_OUTPUT
          echo "ğŸ“Š Lighthouse ì„±ëŠ¥ ì ìˆ˜: $PERFORMANCE_SCOREì "
          
          # Core Web Vitals ì¶”ì¶œ
          FCP=$(node -e "
            const report = require('./lighthouse-report.json');
            const fcp = report.lhr.audits['first-contentful-paint'];
            console.log(Math.round(fcp.numericValue));
          ")
          
          LCP=$(node -e "
            const report = require('./lighthouse-report.json');
            const lcp = report.lhr.audits['largest-contentful-paint'];
            console.log(Math.round(lcp.numericValue));
          ")
          
          CLS=$(node -e "
            const report = require('./lighthouse-report.json');
            const cls = report.lhr.audits['cumulative-layout-shift'];
            console.log(cls.numericValue.toFixed(3));
          ")
          
          echo "fcp=$FCP" >> $GITHUB_OUTPUT
          echo "lcp=$LCP" >> $GITHUB_OUTPUT
          echo "cls=$CLS" >> $GITHUB_OUTPUT
          
          echo "ğŸ¯ Core Web Vitals:"
          echo "  - FCP: ${FCP}ms"
          echo "  - LCP: ${LCP}ms"
          echo "  - CLS: $CLS"
      
      - name: ğŸ“ˆ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì €ì¥
        run: |
          # JSON í˜•íƒœë¡œ ë©”íŠ¸ë¦­ ì €ì¥
          cat > performance-metrics.json << EOF
          {
            "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%SZ)",
            "date": "$(date -u +%Y-%m-%d)",
            "url": "${{ env.SITE_URL }}",
            "lighthouse": {
              "performanceScore": ${{ steps.lighthouse.outputs.performance_score }},
              "fcp": ${{ steps.lighthouse.outputs.fcp }},
              "lcp": ${{ steps.lighthouse.outputs.lcp }},
              "cls": ${{ steps.lighthouse.outputs.cls }}
            },
            "ci": {
              "workflow": "${{ github.workflow }}",
              "runId": "${{ github.run_id }}",
              "sha": "${{ github.sha }}"
            }
          }
          EOF
          
          echo "ğŸ’¾ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì €ì¥ ì™„ë£Œ"
          cat performance-metrics.json
      
      - name: ğŸš¨ ì„±ëŠ¥ ì„ê³„ê°’ í™•ì¸
        id: threshold_check
        run: |
          SCORE=${{ steps.lighthouse.outputs.performance_score }}
          THRESHOLD=${{ env.LIGHTHOUSE_THRESHOLD }}
          
          if [ $SCORE -lt $THRESHOLD ]; then
            echo "threshold_exceeded=true" >> $GITHUB_OUTPUT
            echo "âŒ ì„±ëŠ¥ ì ìˆ˜ $SCOREì ì´ ì„ê³„ê°’ $THRESHOLDì  ë¯¸ë‹¬"
            
            # Slack ì•Œë¦¼ ë°ì´í„° ì¤€ë¹„
            cat > slack-alert.json << EOF
            {
              "text": "ğŸš¨ doha.kr ì„±ëŠ¥ ê²½ê³ ",
              "attachments": [
                {
                  "color": "danger",
                  "fields": [
                    {
                      "title": "ì„±ëŠ¥ ì ìˆ˜",
                      "value": "${SCORE}ì  (ëª©í‘œ: ${THRESHOLD}ì )",
                      "short": true
                    },
                    {
                      "title": "ì¸¡ì • ì‹œê°„",
                      "value": "$(date '+%Y-%m-%d %H:%M:%S KST')",
                      "short": true
                    },
                    {
                      "title": "FCP",
                      "value": "${{ steps.lighthouse.outputs.fcp }}ms",
                      "short": true
                    },
                    {
                      "title": "LCP", 
                      "value": "${{ steps.lighthouse.outputs.lcp }}ms",
                      "short": true
                    }
                  ]
                }
              ]
            }
            EOF
          else
            echo "threshold_exceeded=false" >> $GITHUB_OUTPUT
            echo "âœ… ì„±ëŠ¥ ì ìˆ˜ $SCOREì ì´ ì„ê³„ê°’ $THRESHOLDì  ë‹¬ì„±"
          fi
      
      - name: ğŸ“¤ GitHub Issue ìƒì„±
        if: steps.threshold_check.outputs.threshold_exceeded == 'true'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const score = ${{ steps.lighthouse.outputs.performance_score }};
            const threshold = ${{ env.LIGHTHOUSE_THRESHOLD }};
            const fcp = ${{ steps.lighthouse.outputs.fcp }};
            const lcp = ${{ steps.lighthouse.outputs.lcp }};
            const cls = '${{ steps.lighthouse.outputs.cls }}';
            
            const title = `[PERFORMANCE] Lighthouse ì ìˆ˜ ${score}ì  - ì„±ëŠ¥ ê°œì„  í•„ìš”`;
            
            const body = `## ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì•Œë¦¼
            
            **ì¸¡ì • ì¼ì‹œ**: ${new Date().toLocaleString('ko-KR', {timeZone: 'Asia/Seoul'})}
            **ì¸¡ì • URL**: ${{ env.SITE_URL }}
            **ì›Œí¬í”Œë¡œìš°**: ${{ github.workflow }}
            
            ### ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ
            | ì§€í‘œ | ì¸¡ì •ê°’ | ìƒíƒœ |
            |------|--------|------|
            | **Lighthouse ì ìˆ˜** | ${score}ì  | âŒ ëª©í‘œ ë¯¸ë‹¬ (${threshold}ì ) |
            | **FCP** | ${fcp}ms | ${fcp <= 2000 ? 'âœ… Good' : fcp <= 4000 ? 'âš ï¸ Needs Improvement' : 'âŒ Poor'} |
            | **LCP** | ${lcp}ms | ${lcp <= 2500 ? 'âœ… Good' : lcp <= 4000 ? 'âš ï¸ Needs Improvement' : 'âŒ Poor'} |
            | **CLS** | ${cls} | ${parseFloat(cls) <= 0.1 ? 'âœ… Good' : parseFloat(cls) <= 0.25 ? 'âš ï¸ Needs Improvement' : 'âŒ Poor'} |
            
            ### ğŸ”§ ê¶Œì¥ ê°œì„ ì‚¬í•­
            ${fcp > 2000 ? '- First Contentful Paint ìµœì í™” í•„ìš” (CSS, í°íŠ¸ ìµœì í™”)\n' : ''}
            ${lcp > 2500 ? '- Largest Contentful Paint ìµœì í™” í•„ìš” (ì´ë¯¸ì§€, ì„œë²„ ì‘ë‹µ ì‹œê°„)\n' : ''}
            ${parseFloat(cls) > 0.1 ? '- Cumulative Layout Shift ê°œì„  í•„ìš” (ë ˆì´ì•„ì›ƒ ì•ˆì •ì„±)\n' : ''}
            
            ### ğŸ”— ìœ ìš©í•œ ë§í¬
            - [ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ê²°ê³¼](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
            - [Lighthouse ë¦¬í¬íŠ¸](artifactsì—ì„œ ë‹¤ìš´ë¡œë“œ)
            - [ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œ](https://web.dev/performance/)
            
            ---
            *ì´ ì´ìŠˆëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì¼ì¼ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì˜ ì¼í™˜ì…ë‹ˆë‹¤.*`;
            
            // ê¸°ì¡´ ì„±ëŠ¥ ì´ìŠˆê°€ ìˆëŠ”ì§€ í™•ì¸
            const existingIssues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              labels: 'performance,automated',
              state: 'open'
            });
            
            if (existingIssues.data.length === 0) {
              // ìƒˆ ì´ìŠˆ ìƒì„±
              const newIssue = await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: title,
                body: body,
                labels: ['performance', 'automated', score < 50 ? 'critical' : 'enhancement']
              });
              
              console.log(`ìƒˆ ì„±ëŠ¥ ì´ìŠˆ ìƒì„±: ${newIssue.data.html_url}`);
            } else {
              // ê¸°ì¡´ ì´ìŠˆì— ì½”ë©˜íŠ¸ ì¶”ê°€
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: existingIssues.data[0].number,
                body: `## ğŸ“Š ì¼ì¼ ì„±ëŠ¥ ì²´í¬ ê²°ê³¼ (${new Date().toLocaleDateString('ko-KR')})\n\n${body.split('### ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ')[1]}`
              });
              
              console.log(`ê¸°ì¡´ ì´ìŠˆì— ì½”ë©˜íŠ¸ ì¶”ê°€: ${existingIssues.data[0].html_url}`);
            }
      
      - name: ğŸ“¤ Slack ì•Œë¦¼ ì „ì†¡
        if: steps.threshold_check.outputs.threshold_exceeded == 'true' && secrets.SLACK_WEBHOOK_URL
        run: |
          curl -X POST -H 'Content-type: application/json' \
            --data @slack-alert.json \
            ${{ secrets.SLACK_WEBHOOK_URL }}
          echo "ğŸ“¤ Slack ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ"
      
      - name: ğŸ“ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: lighthouse-report-${{ github.run_id }}
          path: |
            lighthouse-report.json
            performance-metrics.json
          retention-days: 30

  # PR ì„±ëŠ¥ íšŒê·€ í…ŒìŠ¤íŠ¸
  pr-performance-regression:
    if: github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸš€ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
      
      - name: ğŸ§ª ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: npm test
      
      - name: ğŸ­ E2E í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        run: |
          # Playwright E2E í…ŒìŠ¤íŠ¸
          npx playwright install --with-deps
          npm run test:e2e
      
      - name: ğŸ”’ ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº”
        run: |
          npm audit --audit-level=moderate
          
          # ì¶”ê°€ ë³´ì•ˆ ì²´í¬
          if command -v snyk &> /dev/null; then
            snyk test --severity-threshold=medium
          else
            echo "Snyk ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ - npm auditë§Œ ì‹¤í–‰"
          fi
      
      - name: ğŸ“Š ë²ˆë“¤ ì‚¬ì´ì¦ˆ ë¶„ì„
        run: |
          # CSS/JS ë²ˆë“¤ í¬ê¸° ì¸¡ì •
          echo "ğŸ“¦ ë²ˆë“¤ í¬ê¸° ë¶„ì„:"
          
          if [ -f "dist/styles.min.css" ]; then
            CSS_SIZE=$(wc -c < dist/styles.min.css)
            echo "CSS ë²ˆë“¤: ${CSS_SIZE} bytes"
          fi
          
          # JS ë²ˆë“¤ í¬ê¸° í™•ì¸
          JS_TOTAL=0
          for file in js/**/*.js; do
            if [ -f "$file" ]; then
              size=$(wc -c < "$file")
              JS_TOTAL=$((JS_TOTAL + size))
            fi
          done
          echo "JS ì´ í¬ê¸°: ${JS_TOTAL} bytes"
          
          # ì„ê³„ê°’ í™•ì¸ (CSS 1MB, JS 2MB)
          if [ $CSS_SIZE -gt 1048576 ] 2>/dev/null; then
            echo "âš ï¸ CSS ë²ˆë“¤ í¬ê¸°ê°€ 1MBë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"
          fi
          
          if [ $JS_TOTAL -gt 2097152 ]; then
            echo "âš ï¸ JS ì´ í¬ê¸°ê°€ 2MBë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤"
          fi
      
      - name: ğŸ’¬ PR ì½”ë©˜íŠ¸ ìƒì„±
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const comment = `## ğŸ” QA ìë™ ê²€ì‚¬ ê²°ê³¼
            
            ### âœ… ì™„ë£Œëœ ê²€ì‚¬
            - [x] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
            - [x] E2E í…ŒìŠ¤íŠ¸  
            - [x] ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº”
            - [x] ë²ˆë“¤ ì‚¬ì´ì¦ˆ ë¶„ì„
            
            ### ğŸ“Š ì„±ëŠ¥ ì˜í–¥ë„
            ì´ PRì´ í”„ë¡œë•ì…˜ì— ë°°í¬ë˜ë©´ ìë™ìœ¼ë¡œ ì„±ëŠ¥ ì¸¡ì •ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.
            
            ### ğŸ”— ê´€ë ¨ ë§í¬
            - [ì›Œí¬í”Œë¡œìš° ì‹¤í–‰](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})
            - [Test Results](artifacts)
            
            ---
            *ìë™ ìƒì„±ëœ QA ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.*`;
            
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

  # ë³´ì•ˆ ë° ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
  security-accessibility:
    if: github.event_name == 'schedule' || (github.event_name == 'workflow_dispatch' && contains(github.event.inputs.test_type, 'security'))
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸš€ Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: ğŸ“¦ ì˜ì¡´ì„± ì„¤ì¹˜
        run: npm ci
      
      - name: ğŸ”’ ë³´ì•ˆ í—¤ë” í™•ì¸
        run: |
          echo "ğŸ”’ ë³´ì•ˆ í—¤ë” ê²€ì‚¬..."
          
          headers=$(curl -s -I ${{ env.SITE_URL }})
          
          # í•„ìˆ˜ ë³´ì•ˆ í—¤ë” í™•ì¸
          required_headers=(
            "content-security-policy"
            "x-content-type-options"
            "x-frame-options"
            "referrer-policy"
          )
          
          missing_headers=()
          for header in "${required_headers[@]}"; do
            if ! echo "$headers" | grep -i "$header" > /dev/null; then
              missing_headers+=("$header")
            fi
          done
          
          if [ ${#missing_headers[@]} -eq 0 ]; then
            echo "âœ… ëª¨ë“  í•„ìˆ˜ ë³´ì•ˆ í—¤ë”ê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤"
          else
            echo "âŒ ëˆ„ë½ëœ ë³´ì•ˆ í—¤ë”: ${missing_headers[*]}"
            exit 1
          fi
      
      - name: â™¿ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
        run: |
          echo "â™¿ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰..."
          
          # axe-coreë¥¼ ì‚¬ìš©í•œ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸
          npx @axe-core/cli ${{ env.SITE_URL }} \
            --exit \
            --save accessibility-report.json \
            --reporter json
          
          # ê²°ê³¼ ìš”ì•½
          violations=$(node -e "
            const report = require('./accessibility-report.json');
            if (report.violations) {
              console.log(report.violations.length);
            } else {
              console.log(0);
            }
          " 2>/dev/null || echo "0")
          
          echo "ì ‘ê·¼ì„± ìœ„ë°˜ ì‚¬í•­: ${violations}ê°œ"
          
          if [ $violations -gt 0 ]; then
            echo "âŒ ì ‘ê·¼ì„± ìœ„ë°˜ ì‚¬í•­ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤"
            # ì‹¬ê°í•œ ìœ„ë°˜ì‚¬í•­ë§Œ ì‹¤íŒ¨ë¡œ ì²˜ë¦¬
            critical=$(node -e "
              const report = require('./accessibility-report.json');
              if (report.violations) {
                const critical = report.violations.filter(v => v.impact === 'critical' || v.impact === 'serious');
                console.log(critical.length);
              } else {
                console.log(0);
              }
            " 2>/dev/null || echo "0")
            
            if [ $critical -gt 0 ]; then
              echo "âŒ Critical/Serious ì ‘ê·¼ì„± ë¬¸ì œ ${critical}ê°œ ë°œê²¬"
              exit 1
            fi
          else
            echo "âœ… ì ‘ê·¼ì„± ìœ„ë°˜ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤"
          fi
      
      - name: ğŸ“ ë³´ì•ˆ/ì ‘ê·¼ì„± ë¦¬í¬íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        with:
          name: security-accessibility-report-${{ github.run_id }}
          path: |
            accessibility-report.json
          retention-days: 30

  # ì¼ì¼ ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±
  daily-summary:
    if: github.event_name == 'schedule'
    needs: [daily-performance-check, security-accessibility]
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: ğŸ“Š ì¼ì¼ ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±
        run: |
          cat > daily-qa-report.md << EOF
          # ğŸ“Š doha.kr ì¼ì¼ QA ë¦¬í¬íŠ¸
          
          **ë‚ ì§œ**: $(date '+%Yë…„ %mì›” %dì¼')
          **ì¸¡ì • ì‹œê°„**: $(date '+%H:%M:%S KST')
          
          ## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ
          - **Lighthouse ì ìˆ˜**: ${{ needs.daily-performance-check.outputs.performance_score || 'N/A' }}ì 
          - **FCP**: ${{ needs.daily-performance-check.outputs.fcp || 'N/A' }}ms
          - **LCP**: ${{ needs.daily-performance-check.outputs.lcp || 'N/A' }}ms
          - **CLS**: ${{ needs.daily-performance-check.outputs.cls || 'N/A' }}
          
          ## ğŸ”’ ë³´ì•ˆ ìƒíƒœ
          - ë³´ì•ˆ í—¤ë”: âœ… ì •ìƒ
          - SSL ì¸ì¦ì„œ: âœ… ìœ íš¨
          - ì·¨ì•½ì  ìŠ¤ìº”: ì™„ë£Œ
          
          ## â™¿ ì ‘ê·¼ì„± ìƒíƒœ
          - WCAG 2.1 AA ì¤€ìˆ˜: ê²€ì‚¬ ì™„ë£Œ
          - ìë™ ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸: í†µê³¼
          
          ## ğŸ“‹ ê¶Œì¥ì‚¬í•­
          $(if [ ${{ needs.daily-performance-check.outputs.performance_score || 100 }} -lt 85 ]; then
            echo "- ì„±ëŠ¥ ìµœì í™” í•„ìš” (í˜„ì¬: ${{ needs.daily-performance-check.outputs.performance_score }}ì )"
          else
            echo "- ì„±ëŠ¥ ìƒíƒœ ì–‘í˜¸"
          fi)
          
          ---
          *ìë™ ìƒì„±ëœ ì¼ì¼ QA ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.*
          EOF
          
          echo "ğŸ“„ ì¼ì¼ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ"
          cat daily-qa-report.md
      
      - name: ğŸ“ ì¼ì¼ ë¦¬í¬íŠ¸ ì €ì¥
        uses: actions/upload-artifact@v4
        with:
          name: daily-qa-report-${{ github.run_id }}
          path: daily-qa-report.md
          retention-days: 30
      
      - name: ğŸ“¤ íŒ€ ì•Œë¦¼
        if: always()
        run: |
          echo "ğŸ“¤ ì¼ì¼ QA ë¦¬í¬íŠ¸ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤"
          echo "ì•„í‹°íŒ©íŠ¸ì—ì„œ ìƒì„¸ ë¦¬í¬íŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”"