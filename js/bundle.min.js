!function(){"use strict";const t={sanitizeHTML:function(t){if(!t)return"";if("undefined"!=typeof DOMPurify)return DOMPurify.sanitize(t);const e=document.createElement("div");return e.textContent=t,e.innerHTML},sanitizeAttr:function(t){return t?String(t).replace(/['"<>&]/g,function(t){return{'"':"&quot;","'":"&#x27;","<":"&lt;",">":"&gt;","&":"&amp;"}[t]}):""},sanitizeURL:function(t){if(!t)return"";try{const e=new URL(t,window.location.href);return["http:","https:","mailto:"].includes(e.protocol)?e.href:(console.warn("Blocked potentially dangerous URL:",t),"")}catch(e){return console.error("Invalid URL:",t),""}},validateNumber:function(t,e=0,n=1/0){const r=parseFloat(t);return isNaN(r)||!isFinite(r)?e:Math.max(e,Math.min(n,r))},validateEmail:function(t){if(!t)return!1;return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(t).toLowerCase())},validatePhone:function(t){if(!t)return!1;const e=t.replace(/\D/g,"");return/^(01[0-9]{8,9}|02[0-9]{7,8}|0[3-9][0-9]{7,8})$/.test(e)},generateCSRFToken:function(){return window.crypto&&window.crypto.getRandomValues?[...crypto.getRandomValues(new Uint8Array(32))].map(t=>t.toString(16).padStart(2,"0")).join(""):Date.now().toString(36)+Math.random().toString(36).substr(2)},validateCSRFToken:function(t,e){return!(!t||!e)&&t===e},escapeRegex:function(t){return t?t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):""},containsDangerousContent:function(t){if(!t)return!1;return[/<script[^>]*>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe/gi,/<object/gi,/<embed/gi,/eval\s*\(/gi,/expression\s*\(/gi].some(e=>e.test(t))},safeJSONParse:function(t,e=null){try{return JSON.parse(t)}catch(t){return console.error("JSON parse error:",t),e}},validateAllowedChars:function(t,e=!1){if(!t)return!0;return(e?/^[가-힣a-zA-Z0-9\s\-\_\.\,\!\?\@\#\$\%\&\*\(\)\[\]\{\}]+$/:/^[가-힣a-zA-Z0-9\s\-\_\.\,\!\?]+$/).test(t)},createSafeElement:function(t,e,n={}){const r=document.createElement(t);return e&&(r.textContent=e),Object.keys(n).forEach(t=>{if(t.toLowerCase().startsWith("on"))return void console.warn("Event handler attributes not allowed");const e=this.sanitizeAttr(n[t]);r.setAttribute(t,e)}),r},getCSPNonce:function(){const t=document.querySelector('meta[name="csp-nonce"]');return t?t.content:""},createRateLimiter:function(t,e){const n=[];return function(){const r=Date.now(),o=r-e;for(;n.length>0&&n[0]<o;)n.shift();return n.length>=t?(console.warn("Rate limit exceeded"),!1):(n.push(r),!0)}}};window.Security=t,document.addEventListener("DOMContentLoaded",function(){document.addEventListener("input",function(e){if(e.target.matches('input[type="text"], input[type="email"], textarea')){const n=e.target.maxLength||1e3;e.target.value.length>n&&(e.target.value=e.target.value.substring(0,n)),//한글입력허용}}),document.addEventListener("submit",function(e){const n=e.target.querySelectorAll("input, textarea, select");for(let r of n)if(t.containsDangerousContent(r.value))return e.preventDefault(),console.error("Form submission blocked: dangerous content detected"),"function"==typeof showNotification?showNotification("입력 내용에 허용되지 않는 문자가 포함되어 있습니다.","error"):alert("입력 내용에 허용되지 않는 문자가 포함되어 있습니다."),!1})}),console.log("Security utilities loaded successfully")}();!function(){"use strict";const e={config:{enableConsoleLog:!0,enableAnalytics:!0,maxErrorsPerSession:50,retryAttempts:3,retryDelay:1e3},errorCount:0,errorCache:new Set,init:function(){this.setupGlobalErrorHandlers(),this.setupPromiseRejectionHandler(),this.setupResourceErrorHandlers(),console.log("Error handling system initialized")},setupGlobalErrorHandlers:function(){const e=this;window.addEventListener("error",function(r){e.handleError({type:"javascript",message:r.message,filename:r.filename,lineno:r.lineno,colno:r.colno,error:r.error,stack:r.error?r.error.stack:null})})},setupPromiseRejectionHandler:function(){const e=this;window.addEventListener("unhandledrejection",function(r){e.handleError({type:"promise",message:"Unhandled Promise Rejection",reason:r.reason,promise:r.promise,stack:r.reason&&r.reason.stack?r.reason.stack:null}),r.preventDefault()})},setupResourceErrorHandlers:function(){const e=this;document.addEventListener("error",function(r){"IMG"===r.target.tagName&&(e.handleResourceError("image",r.target.src),e.handleImageError(r.target))},!0),document.addEventListener("error",function(r){"SCRIPT"===r.target.tagName&&e.handleResourceError("script",r.target.src)},!0),document.addEventListener("error",function(r){"LINK"===r.target.tagName&&"stylesheet"===r.target.rel&&e.handleResourceError("stylesheet",r.target.href)},!0)},handleError:function(e){if(this.errorCount>=this.config.maxErrorsPerSession)return;const r=this.createErrorSignature(e);this.errorCache.has(r)||(this.errorCount++,this.errorCache.add(r),this.config.enableConsoleLog&&console.error("🚨 Error caught by global handler:",e),this.config.enableAnalytics&&this.sendToAnalytics(e),this.isCriticalError(e)&&this.showUserErrorMessage(e),this.attemptRecovery(e))},handleResourceError:function(e,r){const n={type:"resource",resourceType:e,src:r,message:`Failed to load ${e}: ${r}`};this.handleError(n)},handleImageError:function(e){e.dataset.errorHandled||(e.dataset.errorHandled="true",e.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4=",e.alt="Image not found")},createErrorSignature:function(e){return`${e.type}_${e.message}_${e.filename||""}_${e.lineno||""}`},isCriticalError:function(e){const r=(e.message||"").toLowerCase();return["network","fetch","api","security","permission","quota"].some(e=>r.includes(e))},showUserErrorMessage:function(e){const r={network:"네트워크 연결을 확인해 주세요.",fetch:"데이터를 불러오는 중 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.",api:"서비스에 일시적인 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.",security:"보안 오류가 발생했습니다. 페이지를 새로고침해 주세요.",permission:"권한 오류가 발생했습니다.",quota:"저장 공간이 부족합니다. 브라우저 캐시를 정리해 주세요."},n=(e.message||"").toLowerCase();let t="일시적인 오류가 발생했습니다. 페이지를 새로고침해 주세요.";for(const[e,o]of Object.entries(r))if(n.includes(e)){t=o;break}this.showNotification(t,"error")},showNotification:function(e,r="info"){if("function"==typeof showNotification)return void showNotification(e,r);const n=document.createElement("div");n.className=`error-notification ${r}`,n.innerHTML=`\n                <div class="notification-content">\n                    <span class="notification-icon">${"error"===r?"⚠️":"ℹ️"}</span>\n                    <span class="notification-message">${this.escapeHtml(e)}</span>\n                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n                </div>\n            `,n.style.cssText=`\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                z-index: 10000;\n                background: ${"error"===r?"#ff4444":"#4CAF50"};\n                color: white;\n                padding: 15px;\n                border-radius: 5px;\n                box-shadow: 0 2px 10px rgba(0,0,0,0.3);\n                max-width: 400px;\n                animation: slideIn 0.3s ease-out;\n            `,document.body.appendChild(n),setTimeout(()=>{n.parentElement&&n.remove()},5e3)},escapeHtml:function(e){const r=document.createElement("div");return r.textContent=e,r.innerHTML},sendToAnalytics:function(e){try{"undefined"!=typeof gtag&&gtag("event","exception",{description:e.message,fatal:this.isCriticalError(e),error_type:e.type,file:e.filename||"unknown",line:e.lineno||0}),"undefined"!=typeof Analytics&&Analytics.trackError&&Analytics.trackError(e)}catch(e){console.warn("Failed to send error to analytics:",e)}},attemptRecovery:function(e){"promise"===e.type&&e.message.includes("fetch")&&this.retryFailedRequest(e),"resource"===e.type&&this.retryResourceLoad(e)},retryFailedRequest:function(e){e.retryCount>=this.config.retryAttempts||(e.retryCount=(e.retryCount||0)+1,setTimeout(()=>{console.log(`Retrying failed request (attempt ${e.retryCount})`)},this.config.retryDelay*e.retryCount))},retryResourceLoad:function(e){"script"===e.resourceType&&e.src.includes("main")&&setTimeout(()=>{const r=document.createElement("script");r.src=e.src,document.head.appendChild(r)},2e3)},safeExecute:function(e,r=null,n=[]){try{return e.apply(r,n)}catch(r){return this.handleError({type:"wrapped_function",message:r.message,stack:r.stack,functionName:e.name||"anonymous"}),null}},safeExecuteAsync:async function(e,r=null,n=[]){try{return await e.apply(r,n)}catch(r){return this.handleError({type:"wrapped_async_function",message:r.message,stack:r.stack,functionName:e.name||"anonymous"}),null}},reportError:function(e,r={}){this.handleError({type:"manual",message:e,details:r,stack:(new Error).stack})},clearErrorCache:function(){this.errorCache.clear(),this.errorCount=0},getErrorStats:function(){return{totalErrors:this.errorCount,cachedErrors:this.errorCache.size,maxErrors:this.config.maxErrorsPerSession}}},r=document.createElement("style");r.textContent="\n        @keyframes slideIn {\n            from {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            to {\n                transform: translateX(0);\n                opacity: 1;\n            }\n        }\n        \n        .error-notification .notification-content {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        \n        .error-notification .notification-close {\n            background: none;\n            border: none;\n            color: white;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: auto;\n        }\n        \n        .error-notification .notification-close:hover {\n            opacity: 0.7;\n        }\n    ",document.head.appendChild(r),window.ErrorHandler=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e.init()}):e.init(),console.log("Global error handler loaded successfully")}();!function(){"use strict";const e={config:{enableBotDetection:!0,enableUserTracking:!0,enablePerformanceTracking:!0,enableErrorTracking:!0,maxEventsPerSession:100,sessionTimeout:18e5,apiEndpoint:"/api/analytics"},sessionId:null,userId:null,events:[],botDetected:!1,lastActivity:Date.now(),init:function(){this.sessionId=this.generateSessionId(),this.userId=this.getUserId(),this.detectBot(),this.setupEventListeners(),this.startSessionTracking(),console.log("Analytics system initialized",{sessionId:this.sessionId,botDetected:this.botDetected})},generateSessionId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},getUserId:function(){let e=localStorage.getItem("userId");return e||(e="user_"+Date.now().toString(36)+Math.random().toString(36).substr(2),localStorage.setItem("userId",e)),e},detectBot:function(){if(!this.config.enableBotDetection)return;const e={userAgent:this.checkUserAgentForBot(),webdriver:this.checkWebDriver(),plugins:this.checkPlugins(),languages:this.checkLanguages(),screen:this.checkScreenProperties(),mouse:this.checkMouseBehavior(),timing:this.checkTimingBehavior()};let t=0;return Object.keys(e).forEach(n=>{null!==e[n]&&(t+=e[n]?15:0)}),t+=this.checkSuspiciousBehavior(),this.botDetected=t>30,this.trackEvent("bot_detection",{score:t,detected:this.botDetected,indicators:e}),this.botDetected},checkUserAgentForBot:function(){const e=navigator.userAgent.toLowerCase();return[/bot/i,/crawl/i,/spider/i,/scraper/i,/facebookexternalhit/i,/whatsapp/i,/telegram/i,/linkedinbot/i,/twitterbot/i,/googlebot/i,/bingbot/i,/yandexbot/i,/baiduspider/i,/phantom/i,/selenium/i,/headless/i,/automated/i,/testing/i].some(t=>t.test(e))},checkWebDriver:function(){return!!(window.navigator.webdriver||window.callPhantom||window._phantom||window.phantom||window.Buffer||window.emit||window.spawn)},checkPlugins:function(){if(!navigator.plugins)return!0;if(0===navigator.plugins.length)return!0;const e=Array.from(navigator.plugins).map(e=>e.name.toLowerCase());return["headless","phantom","selenium"].some(t=>e.some(e=>e.includes(t)))},checkLanguages:function(){if(!navigator.languages||0===navigator.languages.length)return!0;const e=navigator.language;return!navigator.languages.includes(e)},checkScreenProperties:function(){const e=`${screen.width}x${screen.height}`;return!!["1024x768","800x600","1280x1024","1366x768","1920x1080"].includes(e)||(0===screen.width||0===screen.height||0===screen.colorDepth)},checkMouseBehavior:function(){let t=0,n=0,i=0,o=0;const s=function(e){if(t++,t>1){const t=Math.abs(e.clientX-i),s=Math.abs(e.clientY-o);(0===t&&s>10||0===s&&t>10)&&n++}i=e.clientX,o=e.clientY,t>=50&&document.removeEventListener("mousemove",s)};return document.addEventListener("mousemove",s),setTimeout(()=>{const i=0===t||n/t>.8?1:0;e.updateBotScore("mouse",i)},5e3),null},checkTimingBehavior:function(){const t=performance.now();let n=0;const i=["click","scroll","keydown","touchstart"],o=function(){n++};return i.forEach(e=>{document.addEventListener(e,o)}),setTimeout(()=>{const s=performance.now()-t,r=n/(s/1e3)>10||s>5e3&&0===n;e.updateBotScore("timing",r?1:0),i.forEach(e=>{document.removeEventListener(e,o)})},1e4),null},checkSuspiciousBehavior:function(){let e=0;if(/mobile|android|iphone|ipad/i.test(navigator.userAgent)&&("ontouchstart"in window||(e+=20)),"undefined"!=typeof Image){const t=new Image;t.style.display="none",document.body.appendChild(t),setTimeout(()=>{!t.complete||0!==t.naturalWidth&&0!==t.naturalHeight||(e+=15),document.body.removeChild(t)},1e3)}let t=0;const n=function(i){t++,t>100&&(e+=10,document.removeEventListener("keydown",n))};return document.addEventListener("keydown",n),e},updateBotScore:function(e,t){this.trackEvent("bot_score_update",{category:e,score:t})},setupEventListeners:function(){const e=this;this.trackPageView(),this.config.enableUserTracking&&!this.botDetected&&this.setupUserInteractionTracking(),this.config.enablePerformanceTracking&&this.setupPerformanceTracking(),this.config.enableErrorTracking&&this.setupErrorTracking(),document.addEventListener("visibilitychange",function(){e.trackEvent("visibility_change",{hidden:document.hidden,timestamp:Date.now()})}),window.addEventListener("beforeunload",function(){e.sendSessionData()})},trackPageView:function(){const e={url:window.location.href,title:document.title,referrer:document.referrer,timestamp:Date.now(),userAgent:navigator.userAgent,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,colorDepth:screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language};this.trackEvent("page_view",e)},setupUserInteractionTracking:function(){const e=this;let t;document.addEventListener("click",function(t){e.trackInteraction("click",t)}),document.addEventListener("submit",function(t){e.trackInteraction("form_submit",t)}),window.addEventListener("scroll",function(){clearTimeout(t),t=setTimeout(()=>{e.trackEvent("scroll",{scrollY:window.scrollY,scrollPercent:Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100)})},250)}),this.startTimeTracking()},trackInteraction:function(e,t){if(this.botDetected)return;const n=t.target,i={type:e,tagName:n.tagName,id:n.id,className:n.className,text:n.textContent?n.textContent.substring(0,100):"",x:t.clientX,y:t.clientY,timestamp:Date.now()};"form_submit"===e&&(i.formAction=n.action,i.formMethod=n.method,i.formElements=n.elements.length),this.trackEvent(e,i)},setupPerformanceTracking:function(){const e=this;window.addEventListener("load",function(){setTimeout(()=>{const t=performance.getEntriesByType("navigation")[0],n=performance.getEntriesByType("paint"),i={loadTime:t.loadEventEnd-t.loadEventStart,domContentLoaded:t.domContentLoadedEventEnd-t.domContentLoadedEventStart,firstPaint:n.find(e=>"first-paint"===e.name)?.startTime||0,firstContentfulPaint:n.find(e=>"first-contentful-paint"===e.name)?.startTime||0,transferSize:t.transferSize,domElements:document.getElementsByTagName("*").length};e.trackEvent("performance",i)},0)}),window.addEventListener("error",function(t){t.target!==window&&e.trackEvent("resource_error",{type:t.target.tagName,src:t.target.src||t.target.href,message:t.message})},!0)},setupErrorTracking:function(){const e=this;if("undefined"!=typeof ErrorHandler){const t=ErrorHandler.handleError;ErrorHandler.handleError=function(n){t.call(this,n),e.trackError(n)}}},startTimeTracking:function(){this.pageStartTime=Date.now();let e=Date.now(),t=0,n=!0;const i=()=>{const i=Date.now();n&&!document.hidden&&(t+=i-e),e=i};["click","scroll","keydown","mousemove","touchstart"].forEach(e=>{document.addEventListener(e,i)}),document.addEventListener("visibilitychange",()=>{n=!document.hidden,i()}),setInterval(()=>{i(),this.trackEvent("time_on_page",{totalTime:Date.now()-this.pageStartTime,activeTime:t})},3e4)},startSessionTracking:function(){const e=this,t=()=>{e.lastActivity=Date.now()};["click","scroll","keydown","mousemove","touchstart"].forEach(e=>{document.addEventListener(e,t)}),setInterval(()=>{Date.now()-e.lastActivity>e.config.sessionTimeout&&e.trackEvent("session_timeout",{duration:Date.now()-e.lastActivity})},6e4)},trackEvent:function(e,t={}){if(this.events.length>=this.config.maxEventsPerSession)return;const n={name:e,data:t,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,url:window.location.href,botDetected:this.botDetected};this.events.push(n),this.sendToGoogleAnalytics(e,t),this.sendToCustomAnalytics(n)},trackError:function(e){this.trackEvent("javascript_error",{message:e.message,type:e.type,filename:e.filename,line:e.lineno,stack:e.stack?e.stack.substring(0,500):null})},sendToGoogleAnalytics:function(e,t){try{"undefined"==typeof gtag||this.botDetected||gtag("event",e,{custom_parameter:JSON.stringify(t).substring(0,100),session_id:this.sessionId,user_id:this.userId})}catch(e){console.warn("Failed to send to Google Analytics:",e)}},sendToCustomAnalytics:function(e){try{this.config.apiEndpoint&&!this.botDetected&&this.queueForBatchSend(e)}catch(e){console.warn("Failed to send to custom analytics:",e)}},queueForBatchSend:function(e){this.sendQueue||(this.sendQueue=[],setInterval(()=>{this.sendQueue.length>0&&this.sendBatch()},1e4)),this.sendQueue.push(e),this.sendQueue.length>=10&&this.sendBatch()},sendBatch:function(){if(!this.sendQueue||0===this.sendQueue.length)return;const e=this.sendQueue.splice(0,10);fetch(this.config.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e,sessionId:this.sessionId,timestamp:Date.now()})}).catch(e=>{console.warn("Failed to send analytics batch:",e)})},sendSessionData:function(){const e={sessionId:this.sessionId,userId:this.userId,duration:Date.now()-this.lastActivity,eventsCount:this.events.length,botDetected:this.botDetected,url:window.location.href};navigator.sendBeacon&&this.config.apiEndpoint&&navigator.sendBeacon(this.config.apiEndpoint+"/session",JSON.stringify(e))},getAnalyticsData:function(){return{sessionId:this.sessionId,userId:this.userId,botDetected:this.botDetected,eventsCount:this.events.length,events:this.events.slice(-10)}},clearData:function(){this.events=[],localStorage.removeItem("userId")}};window.Analytics=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e.init()}):e.init(),console.log("Analytics and bot detection system loaded successfully")}();