!function(){"use strict";const e={config:{enableConsoleLog:!0,enableAnalytics:!0,maxErrorsPerSession:50,retryAttempts:3,retryDelay:1e3},errorCount:0,errorCache:new Set,init:function(){this.setupGlobalErrorHandlers(),this.setupPromiseRejectionHandler(),this.setupResourceErrorHandlers(),console.log("Error handling system initialized")},setupGlobalErrorHandlers:function(){const e=this;window.addEventListener("error",function(r){e.handleError({type:"javascript",message:r.message,filename:r.filename,lineno:r.lineno,colno:r.colno,error:r.error,stack:r.error?r.error.stack:null})})},setupPromiseRejectionHandler:function(){const e=this;window.addEventListener("unhandledrejection",function(r){e.handleError({type:"promise",message:"Unhandled Promise Rejection",reason:r.reason,promise:r.promise,stack:r.reason&&r.reason.stack?r.reason.stack:null}),r.preventDefault()})},setupResourceErrorHandlers:function(){const e=this;document.addEventListener("error",function(r){"IMG"===r.target.tagName&&(e.handleResourceError("image",r.target.src),e.handleImageError(r.target))},!0),document.addEventListener("error",function(r){"SCRIPT"===r.target.tagName&&e.handleResourceError("script",r.target.src)},!0),document.addEventListener("error",function(r){"LINK"===r.target.tagName&&"stylesheet"===r.target.rel&&e.handleResourceError("stylesheet",r.target.href)},!0)},handleError:function(e){if(this.errorCount>=this.config.maxErrorsPerSession)return;const r=this.createErrorSignature(e);this.errorCache.has(r)||(this.errorCount++,this.errorCache.add(r),this.config.enableConsoleLog&&console.error("🚨 Error caught by global handler:",e),this.config.enableAnalytics&&this.sendToAnalytics(e),this.isCriticalError(e)&&this.showUserErrorMessage(e),this.attemptRecovery(e))},handleResourceError:function(e,r){const n={type:"resource",resourceType:e,src:r,message:`Failed to load ${e}: ${r}`};this.handleError(n)},handleImageError:function(e){e.dataset.errorHandled||(e.dataset.errorHandled="true",e.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4=",e.alt="Image not found")},createErrorSignature:function(e){return`${e.type}_${e.message}_${e.filename||""}_${e.lineno||""}`},isCriticalError:function(e){const r=(e.message||"").toLowerCase();return["network","fetch","api","security","permission","quota"].some(e=>r.includes(e))},showUserErrorMessage:function(e){const r={network:"네트워크 연결을 확인해 주세요.",fetch:"데이터를 불러오는 중 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.",api:"서비스에 일시적인 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.",security:"보안 오류가 발생했습니다. 페이지를 새로고침해 주세요.",permission:"권한 오류가 발생했습니다.",quota:"저장 공간이 부족합니다. 브라우저 캐시를 정리해 주세요."},n=(e.message||"").toLowerCase();let t="일시적인 오류가 발생했습니다. 페이지를 새로고침해 주세요.";for(const[e,o]of Object.entries(r))if(n.includes(e)){t=o;break}this.showNotification(t,"error")},showNotification:function(e,r="info"){if("function"==typeof showNotification)return void showNotification(e,r);const n=document.createElement("div");n.className=`error-notification ${r}`,n.innerHTML=`\n                <div class="notification-content">\n                    <span class="notification-icon">${"error"===r?"⚠️":"ℹ️"}</span>\n                    <span class="notification-message">${this.escapeHtml(e)}</span>\n                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n                </div>\n            `,n.style.cssText=`\n                position: fixed;\n                top: 20px;\n                right: 20px;\n                z-index: 10000;\n                background: ${"error"===r?"#ff4444":"#4CAF50"};\n                color: white;\n                padding: 15px;\n                border-radius: 5px;\n                box-shadow: 0 2px 10px rgba(0,0,0,0.3);\n                max-width: 400px;\n                animation: slideIn 0.3s ease-out;\n            `,document.body.appendChild(n),setTimeout(()=>{n.parentElement&&n.remove()},5e3)},escapeHtml:function(e){const r=document.createElement("div");return r.textContent=e,r.innerHTML},sendToAnalytics:function(e){try{"undefined"!=typeof gtag&&gtag("event","exception",{description:e.message,fatal:this.isCriticalError(e),error_type:e.type,file:e.filename||"unknown",line:e.lineno||0}),"undefined"!=typeof Analytics&&Analytics.trackError&&Analytics.trackError(e)}catch(e){console.warn("Failed to send error to analytics:",e)}},attemptRecovery:function(e){"promise"===e.type&&e.message.includes("fetch")&&this.retryFailedRequest(e),"resource"===e.type&&this.retryResourceLoad(e)},retryFailedRequest:function(e){e.retryCount>=this.config.retryAttempts||(e.retryCount=(e.retryCount||0)+1,setTimeout(()=>{console.log(`Retrying failed request (attempt ${e.retryCount})`)},this.config.retryDelay*e.retryCount))},retryResourceLoad:function(e){"script"===e.resourceType&&e.src.includes("main")&&setTimeout(()=>{const r=document.createElement("script");r.src=e.src,document.head.appendChild(r)},2e3)},safeExecute:function(e,r=null,n=[]){try{return e.apply(r,n)}catch(r){return this.handleError({type:"wrapped_function",message:r.message,stack:r.stack,functionName:e.name||"anonymous"}),null}},safeExecuteAsync:async function(e,r=null,n=[]){try{return await e.apply(r,n)}catch(r){return this.handleError({type:"wrapped_async_function",message:r.message,stack:r.stack,functionName:e.name||"anonymous"}),null}},reportError:function(e,r={}){this.handleError({type:"manual",message:e,details:r,stack:(new Error).stack})},clearErrorCache:function(){this.errorCache.clear(),this.errorCount=0},getErrorStats:function(){return{totalErrors:this.errorCount,cachedErrors:this.errorCache.size,maxErrors:this.config.maxErrorsPerSession}}},r=document.createElement("style");r.textContent="\n        @keyframes slideIn {\n            from {\n                transform: translateX(100%);\n                opacity: 0;\n            }\n            to {\n                transform: translateX(0);\n                opacity: 1;\n            }\n        }\n        \n        .error-notification .notification-content {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n        \n        .error-notification .notification-close {\n            background: none;\n            border: none;\n            color: white;\n            font-size: 18px;\n            cursor: pointer;\n            padding: 0;\n            margin-left: auto;\n        }\n        \n        .error-notification .notification-close:hover {\n            opacity: 0.7;\n        }\n    ",document.head.appendChild(r),window.ErrorHandler=e,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){e.init()}):e.init(),console.log("Global error handler loaded successfully")}();