!function(){"use strict";!function(){const ErrorHandler={config:{enableConsoleLog:!0,enableAnalytics:!0,maxErrorsPerSession:50,retryAttempts:3,retryDelay:1e3},errorCount:0,errorCache:new Set,init:function(){this.setupGlobalErrorHandlers(),this.setupPromiseRejectionHandler(),this.setupResourceErrorHandlers()},setupGlobalErrorHandlers:function(){const self=this;window.addEventListener("error",function(event){self.handleError({type:"javascript",message:event.message,filename:event.filename,lineno:event.lineno,colno:event.colno,error:event.error,stack:event.error?event.error.stack:null})})},setupPromiseRejectionHandler:function(){const self=this;window.addEventListener("unhandledrejection",function(event){self.handleError({type:"promise",message:"Unhandled Promise Rejection",reason:event.reason,promise:event.promise,stack:event.reason&&event.reason.stack?event.reason.stack:null}),event.preventDefault()})},setupResourceErrorHandlers:function(){const self=this;document.addEventListener("error",function(event){"IMG"===event.target.tagName&&(self.handleResourceError("image",event.target.src),self.handleImageError(event.target))},!0),document.addEventListener("error",function(event){"SCRIPT"===event.target.tagName&&self.handleResourceError("script",event.target.src)},!0),document.addEventListener("error",function(event){"LINK"===event.target.tagName&&"stylesheet"===event.target.rel&&self.handleResourceError("stylesheet",event.target.href)},!0)},handleError:function(errorInfo){if(this.errorCount>=this.config.maxErrorsPerSession)return;const signature=this.createErrorSignature(errorInfo);this.errorCache.has(signature)||(this.errorCount++,this.errorCache.add(signature),this.config.enableConsoleLog,this.config.enableAnalytics&&this.sendToAnalytics(errorInfo),this.isCriticalError(errorInfo)&&this.showUserErrorMessage(errorInfo),this.attemptRecovery(errorInfo))},handleResourceError:function(type,src){const errorInfo={type:"resource",resourceType:type,src:src,message:`Failed to load ${type}: ${src}`};this.handleError(errorInfo)},handleImageError:function(imgElement){imgElement.dataset.errorHandled||(imgElement.dataset.errorHandled="true",imgElement.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4=",imgElement.alt="Image not found")},createErrorSignature:function(errorInfo){return`${errorInfo.type}_${errorInfo.message}_${errorInfo.filename||""}_${errorInfo.lineno||""}`},isCriticalError:function(errorInfo){const criticalKeywords=["network","fetch","api","security","permission","quota"],message=(errorInfo.message||"").toLowerCase();return criticalKeywords.some(keyword=>message.includes(keyword))},showUserErrorMessage:function(errorInfo){const userMessages={network:"네트워크 연결을 확인해 주세요.",fetch:"데이터를 불러오는 중 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.",api:"서비스에 일시적인 문제가 발생했습니다. 잠시 후 다시 시도해 주세요.",security:"보안 오류가 발생했습니다. 페이지를 새로고침해 주세요.",permission:"권한 오류가 발생했습니다.",quota:"저장 공간이 부족합니다. 브라우저 캐시를 정리해 주세요."},message=(errorInfo.message||"").toLowerCase();let userMessage="일시적인 오류가 발생했습니다. 페이지를 새로고침해 주세요.";for(const[key,msg]of Object.entries(userMessages))if(message.includes(key)){userMessage=msg;break}this.showNotification(userMessage,"error")},showNotification:function(message,type="info"){if("function"==typeof showNotification)return void showNotification(message,type);const notification=document.createElement("div");notification.className=`notification notification-${type}`,notification.innerHTML=`\n                <div class="notification-content">\n                    <span class="notification-icon">${"error"===type?"⚠️":"ℹ️"}</span>\n                    <span class="notification-message">${this.escapeHtml(message)}</span>\n                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n                </div>\n            `,document.body.appendChild(notification),setTimeout(()=>{notification.parentElement&&notification.remove()},5e3)},escapeHtml:function(text){const div=document.createElement("div");return div.textContent=text,div.innerHTML},sendToAnalytics:function(errorInfo){try{"undefined"!=typeof gtag&&gtag("event","exception",{description:errorInfo.message,fatal:this.isCriticalError(errorInfo),error_type:errorInfo.type,file:errorInfo.filename||"unknown",line:errorInfo.lineno||0}),"undefined"!=typeof Analytics&&Analytics.trackError&&Analytics.trackError(errorInfo)}catch(analyticsError){}},attemptRecovery:function(errorInfo){"promise"===errorInfo.type&&errorInfo.message.includes("fetch")&&this.retryFailedRequest(errorInfo),"resource"===errorInfo.type&&this.retryResourceLoad(errorInfo)},retryFailedRequest:function(errorInfo){errorInfo.retryCount>=this.config.retryAttempts||(errorInfo.retryCount=(errorInfo.retryCount||0)+1,setTimeout(()=>{},this.config.retryDelay*errorInfo.retryCount))},retryResourceLoad:function(errorInfo){"script"===errorInfo.resourceType&&errorInfo.src.includes("main")&&setTimeout(()=>{const script=document.createElement("script");script.src=errorInfo.src,document.head.appendChild(script)},2e3)},safeExecute:function(fn,context=null,args=[]){try{return fn.apply(context,args)}catch(error){return this.handleError({type:"wrapped_function",message:error.message,stack:error.stack,functionName:fn.name||"anonymous"}),null}},safeExecuteAsync:async function(asyncFn,context=null,args=[]){try{return await asyncFn.apply(context,args)}catch(error){return this.handleError({type:"wrapped_async_function",message:error.message,stack:error.stack,functionName:asyncFn.name||"anonymous"}),null}},reportError:function(message,details={}){this.handleError({type:"manual",message:message,details:details,stack:(new Error).stack})},clearErrorCache:function(){this.errorCache.clear(),this.errorCount=0},getErrorStats:function(){return{totalErrors:this.errorCount,cachedErrors:this.errorCache.size,maxErrors:this.config.maxErrorsPerSession}}},style=document.createElement("style");style.textContent="@keyframes slideIn {from {transform: translateX(100%);opacity: 0;}to {transform: translateX(0);opacity: 1;}}.error-notification .notification-content {display: flex;align-items: center;gap: 10px;}.error-notification .notification-close {background: none;border: none;color: white;font-size: 18px;cursor: pointer;padding: 0;margin-left: auto;}.error-notification .notification-close:hover {opacity: 0.7;}",document.head.appendChild(style),window.ErrorHandler=ErrorHandler,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){ErrorHandler.init()}):ErrorHandler.init()}()}();