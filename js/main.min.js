!function(){"use strict";class DohaMainApp{constructor(){this.initialized=!1,this.components=new Map,this.eventListeners=new Map,this.storage={set:(key,value)=>{try{return localStorage.setItem(key,JSON.stringify(value)),!0}catch(e){return console.warn("Storage set error:",e),!1}},get:key=>{try{const item=localStorage.getItem(key);if(!item)return null;try{return JSON.parse(item)}catch(parseError){return item}}catch(e){return console.warn("Storage get error:",e),null}},remove:key=>{try{return localStorage.removeItem(key),!0}catch(e){return console.warn("Storage remove error:",e),!1}},clear:()=>{try{return localStorage.clear(),!0}catch(e){return console.warn("Storage clear error:",e),!1}}},this.fortuneHelpers={save:(type,data)=>{const today=undefined,fortuneKey=`fortune_${type}_${this.formatDate(new Date,"YYYY-MM-DD")}`;this.storage.set(fortuneKey,data)},load:type=>{const today=undefined,fortuneKey=`fortune_${type}_${this.formatDate(new Date,"YYYY-MM-DD")}`;return this.storage.get(fortuneKey)},share:(platform,fortuneType,_result)=>{const title=`doha.kr에서 ${fortuneType} 결과를 확인했어요!`,url=window.location.href;this.shareResult(platform,title,url)}}}async init(){if(!this.initialized)try{const isDohaAppInitialized=undefined;window.DohaApp&&"function"==typeof window.DohaApp.init||await this.loadComponents(),this.injectStyles(),this.initPageAnimations(),this.initLazyLoading(),this.initDarkMode(),this.fixAdSenseResponsive(),await this.loadDataSystems(),await this.loadPerformanceOptimizer(),this.initialized=!0,console.log("🚀 DohaMainApp v3.0.0 initialized successfully")}catch(error){throw console.error("❌ Failed to initialize DohaMainApp:",error),new ApplicationError("Initialization failed",{cause:error})}}detectEnvironment(){const hostname=window.location.hostname;return"localhost"===hostname||"127.0.0.1"===hostname||hostname.includes("test")?"development":hostname.includes("staging")?"test":"production"}toggleMobileMenu(){if(window.DohaApp?.components?.mobileMenu)return void window.DohaApp.components.mobileMenu.toggle();const navMenu=document.querySelector(".nav-menu, .nav"),menuBtn=document.querySelector(".mobile-menu-btn, .header__menu-toggle");if(navMenu){const isOpen=navMenu.classList.toggle("active");navMenu.classList.toggle("nav--open"),menuBtn&&(menuBtn.setAttribute("aria-expanded",isOpen.toString()),menuBtn.setAttribute("aria-label",isOpen?"메뉴 닫기":"메뉴 열기"))}menuBtn&&menuBtn.classList.toggle("active")}showServices(category,_event){if(window.DohaApp?.components?.tabs)return window.DohaApp.components.tabs.filterServices(category),void this.updateTabButtons(category);const cards=undefined;document.querySelectorAll(".service-card").forEach(card=>{if(card)if("all"===category)card.style.display="block";else{const cardCategories=card.getAttribute("data-category");cardCategories?.includes(category)?card.style.display="block":card.style.display="none"}})}updateTabButtons(category){const buttons=undefined;document.querySelectorAll('.tab-button, [role="tab"]').forEach(btn=>{btn.classList.remove("active","tabs__button--active"),btn.setAttribute("aria-selected","false");const shouldActivate=undefined;("all"===category&&btn.textContent?.includes("전체")||"tests"===category&&btn.textContent?.includes("심리테스트")||"tools"===category&&btn.textContent?.includes("실용도구")||"fortune"===category&&btn.textContent?.includes("운세")||"new"===category&&btn.textContent?.includes("최신"))&&(btn.classList.add("active","tabs__button--active"),btn.setAttribute("aria-selected","true"))})}handleScrollAnimation(){try{const elements=undefined;document.querySelectorAll(".fade-in").forEach(element=>{if(!element)return;const rect=element.getBoundingClientRect(),isVisible=undefined;rect.top<window.innerHeight&&rect.bottom>0&&!element.classList.contains("animated")&&element.classList.add("animated")})}catch(error){console.warn("스크롤 애니메이션 처리 중 오류:",error)}}smoothScroll(target){try{const element=document.querySelector(target);if(!element)return;const headerHeight=document.querySelector(".header")?.offsetHeight||0,targetPosition=element.offsetTop-headerHeight-20;window.scrollTo({top:targetPosition,behavior:"smooth"}),element.setAttribute("tabindex","-1"),element.focus()}catch(error){console.warn("스크롤 처리 중 오류:",error)}}initPageAnimations(){this.handleScrollAnimation();const throttledHandler=this.throttle(()=>this.handleScrollAnimation(),100);window.addEventListener("scroll",throttledHandler)}throttle(func,limit){if(window.DohaApp?.utils?.throttle)return window.DohaApp.utils.throttle(func,limit);let inThrottle;const throttledFunc=function(...args){inThrottle||(func.apply(this,args),inThrottle=!0,setTimeout(()=>inThrottle=!1,limit))};return throttledFunc.cancel=()=>{inThrottle=!1},throttledFunc}validateForm(formId){try{const form=document.getElementById(formId);if(!form)return!0;const inputs=form.querySelectorAll("input[required], textarea[required]");let isValid=!0;return inputs.forEach(input=>{input&&(input.value.trim()?input.classList.remove("error"):(input.classList.add("error"),isValid=!1))}),isValid}catch(error){return console.warn("폼 유효성 검사 중 오류:",error),!1}}setCookie(name,value,days){const expires=new Date;expires.setTime(expires.getTime()+24*days*60*60*1e3),document.cookie=`${name}=${value};expires=${expires.toUTCString()};path=/`}getCookie(name){const nameEQ=name+"=",ca=document.cookie.split(";");for(let i=0;i<ca.length;i++){let c=ca[i];if(c){for(;" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}}return null}shareResult(platform,title,url){try{const text=encodeURIComponent(title||""),encodedUrl=encodeURIComponent(url||window.location.href),shareUrls={facebook:`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`,twitter:`https://twitter.com/intent/tweet?text=${text}&url=${encodedUrl}`,kakao:`https://story.kakao.com/share?url=${encodedUrl}`,line:`https://social-plugins.line.me/lineit/share?url=${encodedUrl}`,copylink:null};"copylink"===platform?(this.copyToClipboard(url||window.location.href),this.showNotification("링크가 복사되었습니다!")):shareUrls[platform]&&window.open(shareUrls[platform],"_blank","width=600,height=400")}catch(error){console.warn("공유 기능 오류:",error),this.showNotification("공유 중 오류가 발생했습니다.","error")}}async copyToClipboard(text){if(navigator.clipboard?.writeText)try{await navigator.clipboard.writeText(text)}catch(err){this.fallbackCopyToClipboard(text)}else this.fallbackCopyToClipboard(text)}fallbackCopyToClipboard(text){const textArea=document.createElement("textarea");textArea.value=text,textArea.style.position="fixed",textArea.style.left="-999999px",document.body.appendChild(textArea),textArea.focus(),textArea.select();try{document.execCommand("copy")}catch(err){console.warn("복사 실패:",err)}document.body.removeChild(textArea)}showNotification(message,type="success"){try{const notification=document.createElement("div");notification.className=`notification notification-${type}`,notification.textContent=message,notification.style.cssText=`\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        padding: 16px 24px;\n        background: ${"success"===type?"#10b981":"#ef4444"};\n        color: white;\n        border-radius: 8px;\n        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);\n        z-index: 9999;\n        animation: slideInRight 0.3s ease;\n      `,document.body.appendChild(notification),setTimeout(()=>{notification.style.animation="slideOutRight 0.3s ease",setTimeout(()=>{notification?.parentNode&&notification.remove()},300)},3e3)}catch(error){console.warn("알림 표시 중 오류:",error)}}debounce(func,wait){if(window.DohaApp?.utils?.debounce)return window.DohaApp.utils.debounce(func,wait);let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout),func(...args)};clearTimeout(timeout),timeout=setTimeout(later,wait)}}formatDate(date,format="YYYY-MM-DD"){try{const d=new Date(date);if(isNaN(d.getTime()))return console.warn("잘못된 날짜 형식:",date),format;const year=d.getFullYear(),month=String(d.getMonth()+1).padStart(2,"0"),day=String(d.getDate()).padStart(2,"0"),hours=String(d.getHours()).padStart(2,"0"),minutes=String(d.getMinutes()).padStart(2,"0");return format.replace("YYYY",year.toString()).replace("MM",month).replace("DD",day).replace("HH",hours).replace("mm",minutes)}catch(error){return console.warn("날짜 포맷팅 오류:",error),format}}formatNumber(num){try{return null==num?"0":num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}catch(error){return console.warn("숫자 포맷팅 오류:",error),"0"}}getUrlParam(name){const urlParams=undefined;return new URLSearchParams(window.location.search).get(name)}initLazyLoading(){try{const images=document.querySelectorAll("img[data-src]:not(.lazy)");if(!images.length)return;if("IntersectionObserver"in window){const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img&&img.dataset&&"src"in img.dataset&&(img.src=img.dataset.src,img.removeAttribute("data-src"),observer.unobserve(img))}})});images.forEach(img=>{img&&imageObserver.observe(img)})}else images.forEach(img=>{img&&img.dataset&&"src"in img.dataset&&(img.src=img.dataset.src,img.removeAttribute("data-src"))})}catch(error){console.warn("이미지 지연 로딩 오류:",error)}}toggleDarkMode(){const isDarkMode=document.body.classList.toggle("dark-mode");return this.storage.set("darkMode",isDarkMode),isDarkMode}initDarkMode(){const isDarkMode=undefined;this.storage.get("darkMode")&&document.body.classList.add("dark-mode")}injectStyles(){const animationStyles="\n@keyframes slideInRight {\n  from {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n  to {\n    transform: translateX(0);\n    opacity: 1;\n  }\n}\n\n@keyframes slideOutRight {\n  from {\n    transform: translateX(0);\n    opacity: 1;\n  }\n  to {\n    transform: translateX(100%);\n    opacity: 0;\n  }\n}\n\n.fade-in.animated {\n  opacity: 1 !important;\n  transform: translateY(0) !important;\n}\n\ninput.error, textarea.error {\n  border-color: #ef4444 !important;\n}\n\n.dark-mode {\n  --gray-50: #111827;\n  --gray-100: #1f2937;\n  --gray-200: #374151;\n  --gray-300: #4b5563;\n  --gray-400: #6b7280;\n  --gray-500: #9ca3af;\n  --gray-600: #d1d5db;\n  --gray-700: #e5e7eb;\n  --gray-800: #f3f4f6;\n  --gray-900: #f9fafb;\n}\n\n.ad-container {\n  min-height: 250px !important;\n  margin: 40px auto !important;\n  max-width: 1200px !important;\n  padding: 0 20px !important;\n  text-align: center !important;\n  width: 100% !important;\n  box-sizing: border-box !important;\n}\n\n.ad-label {\n  font-size: 12px !important;\n  color: #666 !important;\n  margin-bottom: 8px !important;\n  text-align: center !important;\n}\n\n.adsbygoogle {\n  min-height: 90px !important;\n  width: 100% !important;\n  max-width: 100% !important;\n  overflow: hidden !important;\n  display: block !important;\n}\n\n@media (max-width: 320px) {\n  .ad-container {\n    min-width: 300px !important;\n    padding: 0 10px !important;\n  }\n}\n\n@media (max-width: 480px) {\n  .ad-container {\n    min-height: 100px !important;\n    padding: 0 15px !important;\n  }\n}\n\n@media (min-width: 768px) {\n  .ad-container {\n    min-height: 100px !important;\n  }\n}\n\n@media (min-width: 1024px) {\n  .ad-container {\n    min-height: 90px !important;\n  }\n}\n",styleElement=document.createElement("style");styleElement.textContent=animationStyles,document.head.appendChild(styleElement)}async loadComponentById(componentName,targetId){try{const response=await fetch(`/includes/${componentName}.html`);if(!response.ok)throw new Error(`HTTP ${response.status}`);{const html=await response.text(),target=document.getElementById(targetId);target&&window.SecureDOM&&(window.SecureDOM.setInnerHTML(target,html),this.components.set(componentName,target))}}catch(error){console.warn(`Failed to load component ${componentName}:`,error),this.loadFallbackComponent(componentName,targetId)}}loadFallbackComponent(componentName,targetId){const target=document.getElementById(targetId);if(target)if("navbar"===componentName){const navbarHtml='\n        <nav class="navbar">\n          <div class="navbar-container">\n            <a href="/" class="logo">doha.kr</a>\n            <ul class="nav-menu">\n              <li><a href="/" class="nav-link">홈</a></li>\n              <li><a href="/tests/" class="nav-link">심리테스트</a></li>\n              <li><a href="/tools/" class="nav-link">실용도구</a></li>\n              <li><a href="/fortune/" class="nav-link">운세</a></li>\n              <li><a href="/contact/" class="nav-link">문의</a></li>\n              <li><a href="/about/" class="nav-link">소개</a></li>\n            </ul>\n            <button class="mobile-menu-btn" onclick="window.dohaApp?.toggleMobileMenu()">\n              <span></span>\n              <span></span>\n              <span></span>\n            </button>\n          </div>\n        </nav>\n      ';window.SecureDOM?window.SecureDOM.setInnerHTML(target,navbarHtml):target.innerHTML=navbarHtml}else if("footer"===componentName){const footerHtml='\n        <footer class="footer">\n          <div class="footer-content">\n            <div class="footer-section">\n              <h3>doha.kr</h3>\n              <p style="color: var(--gray-400); margin-top: 8px;">\n                일상을 더 재미있게 만드는 공간<br>\n                심리테스트, 실용도구, 운세의 만남\n              </p>\n              <div class="footer-social">\n                <a href="mailto:youtubdoha@gmail.com" class="social-link">📧</a>\n              </div>\n            </div>\n            \n            <div class="footer-section">\n              <h3>서비스</h3>\n              <ul class="footer-links">\n                <li><a href="/">홈</a></li>\n                <li><a href="/tests/">심리테스트</a></li>\n                <li><a href="/tools/">실용도구</a></li>\n                <li><a href="/fortune/">운세</a></li>\n                <li><a href="/about/">사이트 소개</a></li>\n              </ul>\n            </div>\n            \n            <div class="footer-section">\n              <h3>인기 콘텐츠</h3>\n              <ul class="footer-links">\n                <li><a href="/tests/teto-egen/">테토-에겐 테스트</a></li>\n                <li><a href="/tests/mbti/">MBTI 테스트</a></li>\n                <li><a href="/fortune/daily/">오늘의 운세</a></li>\n                <li><a href="/tools/text-counter.html">글자수 세기</a></li>\n              </ul>\n            </div>\n            \n            <div class="footer-section">\n              <h3>운세 & 고객지원</h3>\n              <ul class="footer-links">\n                <li><a href="/fortune/daily/">오늘의 운세</a></li>\n                <li><a href="/fortune/tarot/">타로 카드</a></li>\n                <li><a href="/fortune/zodiac/">별자리 운세</a></li>\n                <li><a href="/contact/">문의하기</a></li>\n              </ul>\n            </div>\n          </div>\n          \n          <div class="footer-bottom">\n            <div class="footer-legal">\n              <a href="/privacy/">개인정보처리방침</a>\n              <a href="/terms/">이용약관</a>\n            </div>\n            <p>&copy; 2025 doha.kr. All rights reserved.</p>\n          </div>\n        </footer>\n      ';window.SecureDOM?window.SecureDOM.setInnerHTML(target,footerHtml):target.innerHTML=footerHtml}}async loadComponents(){const promises=[];document.querySelector("#navbar-placeholder")&&promises.push(this.loadComponentById("navbar","navbar-placeholder")),document.querySelector("#footer-placeholder")&&promises.push(this.loadComponentById("footer","footer-placeholder")),await Promise.allSettled(promises)}fixAdSenseResponsive(){const adContainers=document.querySelectorAll(".ad-container");adContainers.forEach(container=>{container.style.minWidth="300px",container.style.width="100%",container.style.boxSizing="border-box",container.style.padding="0 20px",container.style.margin="40px auto",container.style.maxWidth="1200px";const ins=container.querySelector(".adsbygoogle");ins&&(ins.style.minHeight="90px",ins.style.width="100%",ins.style.maxWidth="100%",ins.style.overflow="hidden",ins.style.display="block",ins.hasAttribute("data-full-width-responsive")||ins.setAttribute("data-full-width-responsive","true"))});const checkAdContainers=()=>{const width=window.innerWidth;adContainers.forEach(container=>{width<320?(container.style.padding="0 10px",container.style.minWidth="300px"):container.style.padding=width<480?"0 15px":"0 20px"})};checkAdContainers(),window.addEventListener("resize",this.debounce(checkAdContainers,250))}initAdSense(){try{this.fixAdSenseResponsive();const adSlots=document.querySelectorAll(".adsbygoogle:not([data-adsbygoogle-status])");if(0===adSlots.length)return;adSlots.forEach(slot=>{const rect=slot.getBoundingClientRect();rect.width<50&&(slot.style.minWidth="320px",slot.style.width="100%"),rect.height<50&&(slot.style.minHeight="100px"),slot.setAttribute("data-adsbygoogle-status","processing")}),void 0!==window.adsbygoogle?adSlots.forEach(slot=>{try{(window.adsbygoogle=window.adsbygoogle||[]).push({}),slot.setAttribute("data-adsbygoogle-status","loaded")}catch(error){console.warn("AdSense 슬롯 로딩 오류:",error),slot.setAttribute("data-adsbygoogle-status","error")}}):setTimeout(()=>this.initAdSense(),2e3)}catch(error){console.warn("AdSense 초기화 전체 오류:",error)}}async loadDataSystems(){try{window.userDataManager||await this.loadScript("/js/storage.js"),window.Analytics&&"function"==typeof window.Analytics.init&&window.Analytics.init(),window.analyticsDashboard||await this.loadScript("/js/analytics-dashboard.js")}catch(error){console.warn("Failed to load data systems:",error)}}async loadPerformanceOptimizer(){try{window.performanceOptimizer||await this.loadScript("/js/performance-optimizer.js")}catch(error){console.warn("Failed to load Performance Optimizer:",error)}}loadScript(src){return new Promise((resolve,reject)=>{const script=document.createElement("script");script.src=src,script.onload=()=>resolve(),script.onerror=()=>reject(new Error(`Failed to load script: ${src}`)),document.head.appendChild(script)})}getPerformanceMetrics(){const navigation=performance.getEntriesByType("navigation")[0];return{loadTime:navigation?navigation.loadEventEnd-navigation.fetchStart:0,renderTime:navigation?navigation.domContentLoadedEventEnd-navigation.fetchStart:0,interactionTime:navigation?navigation.domInteractive-navigation.fetchStart:0,memoryUsage:performance.memory?.usedJSHeapSize||0,networkRequests:performance.getEntriesByType("resource").length}}destroy(){this.eventListeners.clear(),this.components.clear(),this.initialized=!1}}const dohaApp=new DohaMainApp;document.addEventListener("DOMContentLoaded",()=>{dohaApp.init()}),window.addEventListener("load",()=>{setTimeout(()=>dohaApp.initAdSense(),1e3)}),window.dohaApp=dohaApp,window.toggleMobileMenu=()=>dohaApp.toggleMobileMenu(),window.showServices=(category,event)=>dohaApp.showServices(category,event),window.shareResult=(platform,title,url)=>dohaApp.shareResult(platform,title,url),window.showNotification=(message,type)=>dohaApp.showNotification(message,type),window.validateForm=formId=>dohaApp.validateForm(formId),window.storage=dohaApp.storage,window.formatDate=(date,format)=>dohaApp.formatDate(date,format),window.formatNumber=num=>dohaApp.formatNumber(num),window.toggleDarkMode=()=>dohaApp.toggleDarkMode(),window.fortuneHelpers=dohaApp.fortuneHelpers;var __WEBPACK_DEFAULT_EXPORT__=null}();