!function(){"use strict";const Analytics={config:{enableBotDetection:!0,enableUserTracking:!0,enablePerformanceTracking:!0,enableErrorTracking:!0,maxEventsPerSession:100,sessionTimeout:18e5,apiEndpoint:"/api/analytics"},sessionId:null,userId:null,events:[],botDetected:!1,lastActivity:Date.now(),init:function(){this.sessionId=this.generateSessionId(),this.userId=this.getUserId(),this.detectBot(),this.setupEventListeners(),this.startSessionTracking(),console.log("Analytics system initialized",{sessionId:this.sessionId,botDetected:this.botDetected})},generateSessionId:function(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},getUserId:function(){let userId=localStorage.getItem("userId");return userId||(userId="user_"+Date.now().toString(36)+Math.random().toString(36).substr(2),localStorage.setItem("userId",userId)),userId},detectBot:function(){if(!this.config.enableBotDetection)return;const indicators={userAgent:this.checkUserAgentForBot(),webdriver:this.checkWebDriver(),plugins:this.checkPlugins(),languages:this.checkLanguages(),screen:this.checkScreenProperties(),mouse:this.checkMouseBehavior(),timing:this.checkTimingBehavior()};let botScore=0,totalChecks=0;return Object.keys(indicators).forEach(key=>{null!==indicators[key]&&(totalChecks++,botScore+=indicators[key]?15:0)}),botScore+=this.checkSuspiciousBehavior(),this.botDetected=botScore>30,this.trackEvent("bot_detection",{score:botScore,detected:this.botDetected,indicators:indicators}),this.botDetected},checkUserAgentForBot:function(){const userAgent=navigator.userAgent.toLowerCase(),botPatterns=void 0;return[/bot/i,/crawl/i,/spider/i,/scraper/i,/facebookexternalhit/i,/whatsapp/i,/telegram/i,/linkedinbot/i,/twitterbot/i,/googlebot/i,/bingbot/i,/yandexbot/i,/baiduspider/i,/phantom/i,/selenium/i,/headless/i,/automated/i,/testing/i].some(pattern=>pattern.test(userAgent))},checkWebDriver:function(){return!!(window.navigator.webdriver||window.callPhantom||window._phantom||window.phantom||window.Buffer||window.emit||window.spawn)},checkPlugins:function(){if(!navigator.plugins)return!0;if(0===navigator.plugins.length)return!0;const pluginNames=Array.from(navigator.plugins).map(p=>p.name.toLowerCase()),suspiciousPlugins=void 0;return["headless","phantom","selenium"].some(name=>pluginNames.some(plugin=>plugin.includes(name)))},checkLanguages:function(){if(!navigator.languages||0===navigator.languages.length)return!0;const browserLang=navigator.language,acceptedLangs=void 0;return!navigator.languages.includes(browserLang)},checkScreenProperties:function(){const suspiciousSizes=["1024x768","800x600","1280x1024","1366x768","1920x1080"],currentSize=`${screen.width}x${screen.height}`;return!!suspiciousSizes.includes(currentSize)||0===screen.width||0===screen.height||0===screen.colorDepth},checkMouseBehavior:function(){let mouseEvents=0,perfectLines=0,lastX=0,lastY=0;const mouseTracker=function(e){if(mouseEvents++,mouseEvents>1){const deltaX=Math.abs(e.clientX-lastX),deltaY=Math.abs(e.clientY-lastY);(0===deltaX&&deltaY>10||0===deltaY&&deltaX>10)&&perfectLines++}lastX=e.clientX,lastY=e.clientY,mouseEvents>=50&&document.removeEventListener("mousemove",mouseTracker)};return document.addEventListener("mousemove",mouseTracker),setTimeout(()=>{const botScore=0===mouseEvents||perfectLines/mouseEvents>.8?1:0;Analytics.updateBotScore("mouse",botScore)},5e3),null},checkTimingBehavior:function(){const startTime=performance.now();let interactions=0;const interactionTypes=["click","scroll","keydown","touchstart"],interactionHandler=function(){interactions++};return interactionTypes.forEach(type=>{document.addEventListener(type,interactionHandler)}),setTimeout(()=>{const elapsed=performance.now()-startTime,interactionsPerSecond=void 0,isBotLike=interactions/(elapsed/1e3)>10||elapsed>5e3&&0===interactions;Analytics.updateBotScore("timing",isBotLike?1:0),interactionTypes.forEach(type=>{document.removeEventListener(type,interactionHandler)})},1e4),null},checkSuspiciousBehavior:function(){let score=0;if(/mobile|android|iphone|ipad/i.test(navigator.userAgent)&&("ontouchstart"in window||(score+=20)),"undefined"!=typeof Image){const img=new Image;img.style.display="none",document.body.appendChild(img),setTimeout(()=>{!img.complete||0!==img.naturalWidth&&0!==img.naturalHeight||(score+=15),document.body.removeChild(img)},1e3)}let keyEvents=0;const keyHandler=function(e){keyEvents++,keyEvents>100&&(score+=10,document.removeEventListener("keydown",keyHandler))};return document.addEventListener("keydown",keyHandler),score},updateBotScore:function(category,score){this.trackEvent("bot_score_update",{category:category,score:score})},setupEventListeners:function(){const self=this;this.trackPageView(),this.config.enableUserTracking&&!this.botDetected&&this.setupUserInteractionTracking(),this.config.enablePerformanceTracking&&this.setupPerformanceTracking(),this.config.enableErrorTracking&&this.setupErrorTracking(),document.addEventListener("visibilitychange",function(){self.trackEvent("visibility_change",{hidden:document.hidden,timestamp:Date.now()})}),window.addEventListener("beforeunload",function(){self.sendSessionData()})},trackPageView:function(){const pageData={url:window.location.href,title:document.title,referrer:document.referrer,timestamp:Date.now(),userAgent:navigator.userAgent,screenResolution:`${screen.width}x${screen.height}`,viewportSize:`${window.innerWidth}x${window.innerHeight}`,colorDepth:screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language};this.trackEvent("page_view",pageData)},setupUserInteractionTracking:function(){const self=this;let scrollTimeout;document.addEventListener("click",function(e){self.trackInteraction("click",e)}),document.addEventListener("submit",function(e){self.trackInteraction("form_submit",e)}),window.addEventListener("scroll",function(){clearTimeout(scrollTimeout),scrollTimeout=setTimeout(()=>{self.trackEvent("scroll",{scrollY:window.scrollY,scrollPercent:Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100)})},250)}),this.startTimeTracking()},trackInteraction:function(type,event){if(this.botDetected)return;const target=event.target,data={type:type,tagName:target.tagName,id:target.id,className:target.className,text:target.textContent?target.textContent.substring(0,100):"",x:event.clientX,y:event.clientY,timestamp:Date.now()};"form_submit"===type&&(data.formAction=target.action,data.formMethod=target.method,data.formElements=target.elements.length),this.trackEvent(type,data)},setupPerformanceTracking:function(){const self=this;window.addEventListener("load",function(){setTimeout(()=>{const navigation=performance.getEntriesByType("navigation")[0],paint=performance.getEntriesByType("paint"),performanceData={loadTime:navigation.loadEventEnd-navigation.loadEventStart,domContentLoaded:navigation.domContentLoadedEventEnd-navigation.domContentLoadedEventStart,firstPaint:paint.find(p=>"first-paint"===p.name)?.startTime||0,firstContentfulPaint:paint.find(p=>"first-contentful-paint"===p.name)?.startTime||0,transferSize:navigation.transferSize,domElements:document.getElementsByTagName("*").length};self.trackEvent("performance",performanceData)},0)}),window.addEventListener("error",function(e){e.target!==window&&self.trackEvent("resource_error",{type:e.target.tagName,src:e.target.src||e.target.href,message:e.message})},!0)},setupErrorTracking:function(){const self=this;if("undefined"!=typeof ErrorHandler){const originalHandleError=ErrorHandler.handleError;ErrorHandler.handleError=function(errorInfo){originalHandleError.call(this,errorInfo),self.trackError(errorInfo)}}},startTimeTracking:function(){this.pageStartTime=Date.now();let lastActivity=Date.now(),totalActiveTime=0,isActive=!0;const updateActivity=()=>{const now=Date.now();isActive&&!document.hidden&&(totalActiveTime+=now-lastActivity),lastActivity=now};["click","scroll","keydown","mousemove","touchstart"].forEach(event=>{document.addEventListener(event,updateActivity)}),document.addEventListener("visibilitychange",()=>{isActive=!document.hidden,updateActivity()}),setInterval(()=>{updateActivity(),this.trackEvent("time_on_page",{totalTime:Date.now()-this.pageStartTime,activeTime:totalActiveTime})},3e4)},startSessionTracking:function(){const self=this,updateActivity=()=>{self.lastActivity=Date.now()};["click","scroll","keydown","mousemove","touchstart"].forEach(event=>{document.addEventListener(event,updateActivity)}),setInterval(()=>{Date.now()-self.lastActivity>self.config.sessionTimeout&&self.trackEvent("session_timeout",{duration:Date.now()-self.lastActivity})},6e4)},trackEvent:function(eventName,data={}){if(this.events.length>=this.config.maxEventsPerSession)return;const event={name:eventName,data:data,timestamp:Date.now(),sessionId:this.sessionId,userId:this.userId,url:window.location.href,botDetected:this.botDetected};this.events.push(event),this.sendToGoogleAnalytics(eventName,data),this.sendToCustomAnalytics(event)},trackError:function(errorInfo){this.trackEvent("javascript_error",{message:errorInfo.message,type:errorInfo.type,filename:errorInfo.filename,line:errorInfo.lineno,stack:errorInfo.stack?errorInfo.stack.substring(0,500):null})},sendToGoogleAnalytics:function(eventName,data){try{"undefined"==typeof gtag||this.botDetected||gtag("event",eventName,{custom_parameter:JSON.stringify(data).substring(0,100),session_id:this.sessionId,user_id:this.userId})}catch(error){console.warn("Failed to send to Google Analytics:",error)}},sendToCustomAnalytics:function(event){try{this.config.apiEndpoint&&!this.botDetected&&this.queueForBatchSend(event)}catch(error){console.warn("Failed to send to custom analytics:",error)}},queueForBatchSend:function(event){this.sendQueue||(this.sendQueue=[],setInterval(()=>{this.sendQueue.length>0&&this.sendBatch()},1e4)),this.sendQueue.push(event),this.sendQueue.length>=10&&this.sendBatch()},sendBatch:function(){if(!this.sendQueue||0===this.sendQueue.length)return;const batch=this.sendQueue.splice(0,10);fetch(this.config.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:batch,sessionId:this.sessionId,timestamp:Date.now()})}).catch(error=>{console.warn("Failed to send analytics batch:",error)})},sendSessionData:function(){const sessionData={sessionId:this.sessionId,userId:this.userId,duration:Date.now()-this.lastActivity,eventsCount:this.events.length,botDetected:this.botDetected,url:window.location.href};navigator.sendBeacon&&this.config.apiEndpoint&&navigator.sendBeacon(this.config.apiEndpoint+"/session",JSON.stringify(sessionData))},getAnalyticsData:function(){return{sessionId:this.sessionId,userId:this.userId,botDetected:this.botDetected,eventsCount:this.events.length,events:this.events.slice(-10)}},clearData:function(){this.events=[],localStorage.removeItem("userId")}};window.Analytics=Analytics,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){Analytics.init()}):Analytics.init(),console.log("Analytics and bot detection system loaded successfully")}();