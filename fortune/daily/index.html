<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오늘의 운세 - 사주 기반 정확한 일일운세 | doha.kr</title>
    <meta name="description" content="정확한 만세력 사주팔자를 기반으로 분석하는 오늘의 운세. 생년월일시를 입력하여 상세한 일일 운세를 확인하세요.">
    
    <!-- Open Graph -->
    <meta property="og:title" content="오늘의 운세 - 사주 기반 일일운세 | doha.kr">
    <meta property="og:description" content="만세력 기반 정확한 사주팔자로 보는 오늘의 운세">
    <meta property="og:image" content="https://doha.kr/images/og-default.png">
    <meta property="og:url" content="https://doha.kr/fortune/daily/">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Modular CSS -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/fortune/fortune-base.css">
    <link rel="stylesheet" href="/css/fortune/fortune-loading-fix.css">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7905640648499222" crossorigin="anonymous"></script>
    
    <!-- Kakao SDK -->
    <script src="https://t1.kakaocdn.net/kakao_js_sdk/2.4.0/kakao.min.js" integrity="sha384-mXVrIX2T/Kszp6Z0aEWaA8Nm7J6/ZeWXbL8UpGRjKwWe56Srd/iyNmWMBhcItAjH" crossorigin="anonymous"></script>
    
    <!-- 향상된 만세력 시스템 로드 -->
    <script src="/js/lunar-calendar-compact.js"></script>
    <script src="/js/lunar-calendar-loader.js"></script>
    <script src="/js/saju-calculator-enhanced.js"></script>
</head>
<body>
    <!-- 네비게이션 바 -->
    <div id="navbar-placeholder"></div>
    
    <!-- 운세 컨테이너 -->
    <div class="fortune-container">
        <!-- 헤더 -->
        <div class="fortune-header">
            <h1 class="fortune-title">✨ 오늘의 운세</h1>
            <p class="fortune-subtitle">
                정확한 만세력 기반 사주팔자 일일 운세 분석
            </p>
        </div>
        
        <!-- 운세 입력 폼 -->
        <div class="fortune-main" id="fortuneForm">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--fortune-dark);">당신의 정보를 입력해주세요</h2>
            <form onsubmit="generateDailyFortune(event)">
                <div class="fortune-input-section">
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="fortune-input-group" style="flex: 1;">
                            <label for="userName" class="fortune-label">이름</label>
                            <input type="text" id="userName" name="userName" class="fortune-input" placeholder="홍길동" required>
                        </div>
                        
                        <div class="fortune-input-group" style="flex: 1;">
                            <label for="gender" class="fortune-label">성별</label>
                            <select id="gender" name="gender" class="fortune-select">
                                <option value="">선택해주세요</option>
                                <option value="male">남성</option>
                                <option value="female">여성</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div class="fortune-input-group" style="flex: 1;">
                            <label for="birthYear" class="fortune-label">생년</label>
                            <input type="number" id="birthYear" name="birthYear" class="fortune-input" min="1900" max="2025" placeholder="1990" required>
                        </div>
                        
                        <div class="fortune-input-group" style="flex: 1;">
                            <label for="birthMonth" class="fortune-label">생월</label>
                            <input type="number" id="birthMonth" name="birthMonth" class="fortune-input" min="1" max="12" placeholder="1" required>
                        </div>
                        
                        <div class="fortune-input-group" style="flex: 1;">
                            <label for="birthDay" class="fortune-label">생일</label>
                            <input type="number" id="birthDay" name="birthDay" class="fortune-input" min="1" max="31" placeholder="1" required>
                        </div>
                    </div>
                    
                    <div class="fortune-input-group">
                        <label for="birthTime" class="fortune-label">출생시간</label>
                        <select id="birthTime" name="birthTime" class="fortune-select">
                            <option value="-1">모름</option>
                            <option value="23">자시 (23:00-00:59)</option>
                            <option value="1">축시 (01:00-02:59)</option>
                            <option value="3">인시 (03:00-04:59)</option>
                            <option value="5">묘시 (05:00-06:59)</option>
                            <option value="7">진시 (07:00-08:59)</option>
                            <option value="9">사시 (09:00-10:59)</option>
                            <option value="11">오시 (11:00-12:59)</option>
                            <option value="13">미시 (13:00-14:59)</option>
                            <option value="15">신시 (15:00-16:59)</option>
                            <option value="17">유시 (17:00-18:59)</option>
                            <option value="19">술시 (19:00-20:59)</option>
                            <option value="21">해시 (21:00-22:59)</option>
                        </select>
                    </div>
                    
                    <div class="fortune-input-group">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="isLunar" name="isLunar" style="margin-right: 8px;">
                            <span class="fortune-label" style="margin-bottom: 0;">음력 생일입니다</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="fortune-btn fortune-btn-primary" style="width: 100%; margin-top: 30px;">
                        ✨ 정확한 만세력 운세 보기
                    </button>
                </div>
            </form>
        </div>
        
        <!-- 운세 결과 -->
        <div id="fortuneResult" style="display: none;"></div>
        
        <!-- 광고 영역 -->
        <div class="ad-container" style="margin: 40px 0;">
            <div class="ad-label">광고</div>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-7905640648499222"
                 data-ad-slot="1234567890"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>
    </div>
    
    <!-- 푸터 -->
    <div id="footer-placeholder"></div>
    
    <!-- External JavaScript -->
    <script src="/js/main.js"></script>
    <script src="/js/security.js"></script>
    
    <script>
        // 향상된 사주 계산기 인스턴스 생성
        let sajuCalculator = null;
        let currentFortuneData = null;
        
        // 카카오 SDK 초기화
        if (window.Kakao && !window.Kakao.isInitialized()) {
            Kakao.init('19d8ba832f94d513957adc17883c1282');
        }
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 향상된 사주 계산기 초기화
            if (typeof SajuCalculatorEnhanced !== 'undefined') {
                sajuCalculator = new SajuCalculatorEnhanced();
                console.log('향상된 사주 계산기 로드 완료');
            } else {
                console.log('향상된 사주 계산기 로드 실패, 기본 계산기 사용');
            }
        });
        
        // 일일 운세 생성 함수
        function generateDailyFortune(event) {
            event.preventDefault();
            
            const userName = Security.sanitizeInput(document.getElementById('userName').value, 'text');
            const birthYear = Security.validateNumber(document.getElementById('birthYear').value, 1900, 2025);
            const birthMonth = Security.validateNumber(document.getElementById('birthMonth').value, 1, 12);
            const birthDay = Security.validateNumber(document.getElementById('birthDay').value, 1, 31);
            const birthTime = Security.validateNumber(document.getElementById('birthTime').value, 0, 23);
            const isLunar = document.getElementById('isLunar').checked;
            
            // 통합 로딩 표시 (텍스트 회전 방지)
            const resultDiv = document.getElementById('fortuneResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                <div class="fortune-loading">
                    <div class="fortune-loading-icon">🔮</div>
                    <div class="fortune-loading-spinner"></div>
                    <p class="fortune-loading-text">정확한 만세력으로 ${userName}님의 사주를 분석하고 있습니다...</p>
                </div>
            `;
            
            // 폼 숨기기
            document.getElementById('fortuneForm').style.display = 'none';
            
            // 운세 생성 (향상된 계산기 사용)
            setTimeout(() => {
                displayDailyFortune(userName, birthYear, birthMonth, birthDay, birthTime, isLunar);
            }, 2000);
        }
        
        // 일일 운세 표시 함수
        async function displayDailyFortune(userName, birthYear, birthMonth, birthDay, birthTime, isLunar) {
            try {
                // 향상된 사주 계산기 사용
                if (!sajuCalculator) {
                    throw new Error('사주 계산기가 초기화되지 않았습니다.');
                }
                
                // 사주 계산 (향상된 만세력 데이터 사용)
                const saju = await sajuCalculator.calculateSaju(
                    birthYear, 
                    birthMonth, 
                    birthDay, 
                    birthTime >= 0 ? birthTime : 12, 
                    isLunar
                );
                
                // 오늘 날짜
                const today = new Date();
                const todayPillar = sajuCalculator.calculateDayPillar(
                    today.getFullYear(), 
                    today.getMonth() + 1, 
                    today.getDate()
                );
                
                // 사주 해석 생성
                const interpretation = sajuCalculator.generateInterpretation(saju);
                
                // 일주 관계 분석
                const relation = analyzeRelation(saju.dayPillar, todayPillar);
                const fortune = generateDetailedFortune(saju, todayPillar, relation);
                
                // 결과 데이터 저장 (공유용)
                currentFortuneData = {
                    userName,
                    birthYear,
                    birthMonth,
                    birthDay,
                    saju,
                    fortune,
                    today
                };
                
                const resultDiv = document.getElementById('fortuneResult');
                resultDiv.innerHTML = `
                    <div class="fortune-result show">
                        <div class="fortune-result-header">
                            <h2 class="fortune-result-title">
                                🔮 ${userName}님의 ${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일 운세
                            </h2>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>📅 사주팔자 (四柱八字)</h3>
                            <div class="fortune-cards">
                                <div class="fortune-card">
                                    <div class="fortune-card-title">연주 (年柱)</div>
                                    <div class="fortune-card-icon" style="font-size: 24px; margin: 16px 0;">
                                        ${saju.yearPillar.stem}${saju.yearPillar.branch}
                                    </div>
                                    <div class="fortune-card-desc">${saju.tenGods.year}</div>
                                </div>
                                
                                <div class="fortune-card">
                                    <div class="fortune-card-title">월주 (月柱)</div>
                                    <div class="fortune-card-icon" style="font-size: 24px; margin: 16px 0;">
                                        ${saju.monthPillar.stem}${saju.monthPillar.branch}
                                    </div>
                                    <div class="fortune-card-desc">${saju.tenGods.month}</div>
                                </div>
                                
                                <div class="fortune-card selected">
                                    <div class="fortune-card-title">일주 (日柱) ⭐</div>
                                    <div class="fortune-card-icon" style="font-size: 24px; margin: 16px 0;">
                                        ${saju.dayPillar.stem}${saju.dayPillar.branch}
                                    </div>
                                    <div class="fortune-card-desc">일주(본인)</div>
                                </div>
                                
                                <div class="fortune-card ${birthTime < 0 ? 'unknown' : ''}">
                                    <div class="fortune-card-title">시주 (時柱)</div>
                                    <div class="fortune-card-icon" style="font-size: 24px; margin: 16px 0;">
                                        ${birthTime >= 0 ? saju.hourPillar.stem + saju.hourPillar.branch : '??'}
                                    </div>
                                    <div class="fortune-card-desc">${birthTime >= 0 ? saju.tenGods.hour : '미상'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="fortune-result-section" style="background: var(--fortune-gradient); color: white;">
                            <h3>🌅 오늘의 일진</h3>
                            <div style="text-align: center; font-size: 2rem; font-weight: 700; margin: 20px 0;">
                                ${todayPillar.stem}${todayPillar.branch}일
                            </div>
                            <p style="text-align: center; margin: 0;">
                                (${todayPillar.stem}${todayPillar.branch}日)
                            </p>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>🌟 운세 점수</h3>
                            <div class="fortune-cards">
                                <div class="fortune-card">
                                    <div class="fortune-card-icon">💫</div>
                                    <div class="fortune-card-title">총운</div>
                                    <div class="fortune-card-desc" style="font-size: 24px; font-weight: 700; color: ${getScoreColor(fortune.overallScore)};">
                                        ${fortune.overallScore}점
                                    </div>
                                </div>
                                
                                <div class="fortune-card">
                                    <div class="fortune-card-icon">❤️</div>
                                    <div class="fortune-card-title">애정운</div>
                                    <div class="fortune-card-desc" style="font-size: 24px; font-weight: 700; color: ${getScoreColor(fortune.loveScore)};">
                                        ${fortune.loveScore}점
                                    </div>
                                </div>
                                
                                <div class="fortune-card">
                                    <div class="fortune-card-icon">💰</div>
                                    <div class="fortune-card-title">금전운</div>
                                    <div class="fortune-card-desc" style="font-size: 24px; font-weight: 700; color: ${getScoreColor(fortune.moneyScore)};">
                                        ${fortune.moneyScore}점
                                    </div>
                                </div>
                                
                                <div class="fortune-card">
                                    <div class="fortune-card-icon">🏃</div>
                                    <div class="fortune-card-title">건강운</div>
                                    <div class="fortune-card-desc" style="font-size: 24px; font-weight: 700; color: ${getScoreColor(fortune.healthScore)};">
                                        ${fortune.healthScore}점
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>💫 총운</h3>
                            <p>${fortune.overallFortune}</p>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>❤️ 애정운</h3>
                            <p>${fortune.loveFortune}</p>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px; margin-top: 16px;">
                                <strong>💡 조언:</strong> ${fortune.loveAdvice}
                            </div>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>💰 금전운</h3>
                            <p>${fortune.moneyFortune}</p>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px; margin-top: 16px;">
                                <strong>💡 조언:</strong> ${fortune.moneyAdvice}
                            </div>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>💼 직업운</h3>
                            <p>${fortune.careerFortune}</p>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px; margin-top: 16px;">
                                <strong>💡 조언:</strong> ${fortune.careerAdvice}
                            </div>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>🏃 건강운</h3>
                            <p>${fortune.healthFortune}</p>
                            <div style="background: rgba(139, 92, 246, 0.1); padding: 16px; border-radius: 8px; margin-top: 16px;">
                                <strong>💡 조언:</strong> ${fortune.healthAdvice}
                            </div>
                        </div>
                        
                        <div class="fortune-result-section" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                            <h3>🌟 오늘의 행운 요소</h3>
                            <div class="fortune-cards">
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 8px; text-align: center; color: white;">
                                    <div style="font-size: 32px; margin-bottom: 10px;">⏰</div>
                                    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9;">행운의 시간</div>
                                    <div style="font-size: 18px; font-weight: 700;">${fortune.luckyTime}</div>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 8px; text-align: center; color: white;">
                                    <div style="font-size: 32px; margin-bottom: 10px;">🧭</div>
                                    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9;">행운의 방향</div>
                                    <div style="font-size: 18px; font-weight: 700;">${fortune.luckyDirection}</div>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 8px; text-align: center; color: white;">
                                    <div style="font-size: 32px; margin-bottom: 10px;">🎨</div>
                                    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9;">행운의 색상</div>
                                    <div style="font-size: 18px; font-weight: 700;">${fortune.luckyColor}</div>
                                </div>
                                <div style="background: rgba(255, 255, 255, 0.2); padding: 20px; border-radius: 8px; text-align: center; color: white;">
                                    <div style="font-size: 32px; margin-bottom: 10px;">🔢</div>
                                    <div style="font-size: 14px; margin-bottom: 8px; opacity: 0.9;">행운의 숫자</div>
                                    <div style="font-size: 18px; font-weight: 700;">${fortune.luckyNumber}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="fortune-result-section">
                            <h3>📝 오늘의 조언</h3>
                            <p style="font-size: 1.1rem; line-height: 1.8; margin-bottom: 20px;">${fortune.advice}</p>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                                    <strong style="color: #10b981; display: block; margin-bottom: 5px;">✅ 오늘 하면 좋은 일</strong>
                                    ${fortune.doAdvice}
                                </div>
                                <div style="background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">
                                    <strong style="color: #ef4444; display: block; margin-bottom: 5px;">❌ 오늘 피해야 할 일</strong>
                                    ${fortune.dontAdvice}
                                </div>
                            </div>
                        </div>
                        
                        <div class="fortune-share">
                            <h3 class="fortune-share-title">결과 공유하기</h3>
                            <div class="fortune-share-buttons">
                                <button class="fortune-share-btn fortune-share-kakao" onclick="shareFortune()">
                                    💬 카카오톡 공유
                                </button>
                                <button class="fortune-share-btn fortune-share-copy" onclick="copyResultLink()">
                                    🔗 링크 복사
                                </button>
                            </div>
                            <div style="display: flex; gap: 16px; justify-content: center; margin-top: 20px;">
                                <button onclick="location.reload()" class="fortune-btn fortune-btn-primary">다시 보기</button>
                                <a href="/fortune/" class="fortune-btn fortune-btn-secondary">다른 운세 보기</a>
                            </div>
                        </div>
                    </div>
                `;
                
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
            } catch (error) {
                console.error('운세 계산 중 오류:', error);
                const resultDiv = document.getElementById('fortuneResult');
                resultDiv.innerHTML = `
                    <div class="fortune-result show">
                        <div class="fortune-result-header">
                            <h2 class="fortune-result-title" style="color: #e74c3c;">오류가 발생했습니다</h2>
                            <p class="fortune-result-subtitle">
                                운세 계산 중 오류가 발생했습니다. 페이지를 새로고침하여 다시 시도해주세요.
                            </p>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="location.reload()" class="fortune-btn fortune-btn-primary">다시 시도</button>
                        </div>
                    </div>
                `;
            }
        }
        
        // 관계 분석 함수 (기존 코드 유지)
        function analyzeRelation(dayPillar, todayPillar) {
            const relations = {
                stemRelation: analyzeStemRelation(dayPillar.stem, todayPillar.stem),
                branchRelation: analyzeBranchRelation(dayPillar.branch, todayPillar.branch),
                specialRelation: findSpecialRelation(dayPillar.branch, todayPillar.branch)
            };
            
            return relations;
        }
        
        // 천간 관계 분석
        function analyzeStemRelation(stem1, stem2) {
            const stemElements = {
                '갑': '목', '을': '목',
                '병': '화', '정': '화',
                '무': '토', '기': '토',
                '경': '금', '신': '금',
                '임': '수', '계': '수'
            };
            
            const element1 = stemElements[stem1];
            const element2 = stemElements[stem2];
            
            const relations = {
                '목': { generate: '화', control: '토', generated: '수', controlled: '금' },
                '화': { generate: '토', control: '금', generated: '목', controlled: '수' },
                '토': { generate: '금', control: '수', generated: '화', controlled: '목' },
                '금': { generate: '수', control: '목', generated: '토', controlled: '화' },
                '수': { generate: '목', control: '화', generated: '금', controlled: '토' }
            };
            
            if (element1 === element2) return 'same';
            if (relations[element1].generate === element2) return 'generate';
            if (relations[element1].generated === element2) return 'generated';
            if (relations[element1].control === element2) return 'control';
            if (relations[element1].controlled === element2) return 'controlled';
            
            return 'none';
        }
        
        // 지지 관계 분석
        function analyzeBranchRelation(branch1, branch2) {
            const branchElements = {
                '자': '수', '축': '토', '인': '목', '묘': '목',
                '진': '토', '사': '화', '오': '화', '미': '토',
                '신': '금', '유': '금', '술': '토', '해': '수'
            };
            
            const element1 = branchElements[branch1];
            const element2 = branchElements[branch2];
            
            return analyzeStemRelation(element1, element2);
        }
        
        // 특수 관계 찾기
        function findSpecialRelation(branch1, branch2) {
            const combinations = {
                '자': '축', '축': '자',
                '인': '해', '해': '인',
                '묘': '술', '술': '묘',
                '진': '유', '유': '진',
                '사': '신', '신': '사',
                '오': '미', '미': '오'
            };
            
            const clashes = {
                '자': '오', '오': '자',
                '축': '미', '미': '축',
                '인': '신', '신': '인',
                '묘': '유', '유': '묘',
                '진': '술', '술': '진',
                '사': '해', '해': '사'
            };
            
            const punishments = {
                '인': ['사', '신'], '사': ['인', '신'], '신': ['인', '사'],
                '축': ['술', '미'], '술': ['축', '미'], '미': ['축', '술']
            };
            
            if (combinations[branch1] === branch2) {
                return { type: '육합', strength: 'positive' };
            }
            
            if (clashes[branch1] === branch2) {
                return { type: '충', strength: 'negative' };
            }
            
            if (punishments[branch1] && punishments[branch1].includes(branch2)) {
                return { type: '형', strength: 'negative' };
            }
            
            return { type: 'none', strength: 'neutral' };
        }
        
        // 상세 운세 생성
        function generateDetailedFortune(saju, todayPillar, relation) {
            const baseScore = 65;
            let overallScore = baseScore;
            
            if (relation.stemRelation === 'generate' || relation.stemRelation === 'generated') {
                overallScore += 10;
            } else if (relation.stemRelation === 'control' || relation.stemRelation === 'controlled') {
                overallScore -= 10;
            }
            
            if (relation.specialRelation.type === '육합') {
                overallScore += 20;
            } else if (relation.specialRelation.type === '충') {
                overallScore -= 15;
            } else if (relation.specialRelation.type === '형') {
                overallScore -= 10;
            }
            
            overallScore = Math.max(20, Math.min(95, overallScore));
            
            const loveScore = Math.max(20, Math.min(95, overallScore + Math.floor(Math.random() * 20 - 10)));
            const moneyScore = Math.max(20, Math.min(95, overallScore + Math.floor(Math.random() * 20 - 10)));
            const healthScore = Math.max(20, Math.min(95, overallScore + Math.floor(Math.random() * 20 - 10)));
            const careerScore = Math.max(20, Math.min(95, overallScore + Math.floor(Math.random() * 20 - 10)));
            
            const overallFortune = generateOverallMessage(saju, overallScore, relation);
            const loveFortune = generateLoveMessage(saju, loveScore, relation);
            const moneyFortune = generateMoneyMessage(saju, moneyScore, relation);
            const careerFortune = generateCareerMessage(saju, careerScore, relation);
            const healthFortune = generateHealthMessage(saju, healthScore, relation);
            
            const luckyElements = generateLuckyElements(saju, todayPillar);
            const advice = generateAdvice(saju, todayPillar, relation);
            
            return {
                overallScore,
                loveScore,
                moneyScore,
                healthScore,
                overallFortune,
                loveFortune,
                loveAdvice: generateLoveAdvice(saju, loveScore),
                moneyFortune,
                moneyAdvice: generateMoneyAdvice(saju, moneyScore),
                careerFortune,
                careerAdvice: generateCareerAdvice(saju, careerScore),
                healthFortune,
                healthAdvice: generateHealthAdvice(saju, healthScore),
                ...luckyElements,
                ...advice
            };
        }
        
        // 메시지 생성 함수들
        function generateOverallMessage(saju, score) {
            const dayMaster = saju.dayPillar.stem + saju.dayPillar.branch;
            if (score >= 80) {
                return `${dayMaster}일주인 당신의 오늘 운세는 매우 좋습니다! 평소 미뤄왔던 중요한 일을 시작하기에 최적의 날입니다.`;
            } else if (score >= 60) {
                return `${dayMaster}일주인 당신의 오늘 운세는 평균 이상입니다. 안정적인 흐름 속에서 차근차근 일을 진행하는 것이 좋겠습니다.`;
            } else {
                return `${dayMaster}일주인 당신의 오늘 운세는 다소 주의가 필요합니다. 무리하지 말고 신중하게 행동하는 것이 중요합니다.`;
            }
        }
        
        function generateLoveMessage(saju, score) {
            if (score >= 80) {
                return '애정운이 매우 좋은 날입니다. 연인이 있다면 깊은 대화를 나누기 좋고, 싱글이라면 새로운 만남의 기회가 있을 수 있습니다.';
            } else if (score >= 60) {
                return '평온한 애정운입니다. 서로를 이해하고 배려하는 마음이 중요한 시기입니다.';
            } else {
                return '애정 관계에서 약간의 긴장이 있을 수 있습니다. 상대방의 입장을 이해하려고 노력하세요.';
            }
        }
        
        function generateMoneyMessage(saju, score) {
            if (score >= 80) {
                return '금전운이 상승하는 날입니다. 투자나 사업에서 좋은 기회를 포착할 수 있습니다.';
            } else if (score >= 60) {
                return '안정적인 금전 흐름이 예상됩니다. 계획적인 소비와 저축을 실천하기 좋은 날입니다.';
            } else {
                return '금전적으로 신중해야 하는 날입니다. 큰 지출이나 투자는 미루는 것이 좋겠습니다.';
            }
        }
        
        function generateCareerMessage(saju, score) {
            if (score >= 80) {
                return '직장에서의 성과가 돋보이는 날입니다. 새로운 프로젝트나 중요한 업무를 맡기에 좋은 시기입니다.';
            } else if (score >= 60) {
                return '평소와 같은 업무 흐름이 이어집니다. 묵묵히 자신의 일에 집중하면 좋은 결과를 얻을 수 있습니다.';
            } else {
                return '업무상 약간의 어려움이 있을 수 있습니다. 중요한 결정은 다음으로 미루는 것이 현명합니다.';
            }
        }
        
        function generateHealthMessage(saju, score) {
            if (score >= 80) {
                return '건강 상태가 매우 좋은 날입니다. 운동이나 야외 활동을 즐기기에 좋은 날입니다.';
            } else if (score >= 60) {
                return '평소와 비슷한 건강 상태를 유지하고 있습니다. 규칙적인 생활 습관을 유지하세요.';
            } else {
                return '컨디션이 다소 떨어질 수 있는 날입니다. 무리한 활동은 피하고 충분한 휴식을 취하세요.';
            }
        }
        
        // 조언 생성 함수들
        function generateLoveAdvice(saju, score) {
            if (score >= 80) {
                return '오늘은 적극적으로 감정을 표현하세요. 로맨틱한 데이트나 진심 어린 고백이 좋은 결과를 가져올 것입니다.';
            } else if (score >= 60) {
                return '평소보다 더 많은 관심과 배려를 보여주세요. 작은 정성이 큰 감동을 줄 수 있습니다.';
            } else {
                return '감정적으로 예민할 수 있으니 중요한 대화는 미루세요. 혼자만의 시간을 갖는 것도 좋습니다.';
            }
        }
        
        function generateMoneyAdvice(saju, score) {
            if (score >= 80) {
                return '투자나 사업 확장의 좋은 기회입니다. 하지만 욕심을 부리지 말고 분산 투자를 고려하세요.';
            } else if (score >= 60) {
                return '안정적인 재테크 전략을 유지하세요. 장기적인 관점에서 꾸준히 저축하는 것이 중요합니다.';
            } else {
                return '지출을 최소화하고 비상금을 확보하세요. 리스크가 큰 투자는 피하는 것이 좋습니다.';
            }
        }
        
        function generateCareerAdvice(saju, score) {
            if (score >= 80) {
                return '자신감을 갖고 새로운 도전을 시작하세요. 당신의 능력이 빛을 발할 최적의 시기입니다.';
            } else if (score >= 60) {
                return '꾸준함이 성공의 열쇠입니다. 현재 맡은 일에 최선을 다하면 좋은 평가를 받을 것입니다.';
            } else {
                return '실수를 방지하기 위해 두 번 확인하세요. 동료들과의 소통을 강화하여 협력을 구하세요.';
            }
        }
        
        function generateHealthAdvice(saju, score) {
            if (score >= 80) {
                return '활동적인 운동을 즐기기 좋은 날입니다. 새로운 운동을 시작하거나 야외 활동을 계획해보세요.';
            } else if (score >= 60) {
                return '규칙적인 생활 리듬을 유지하세요. 가벼운 스트레칭과 충분한 수분 섭취가 도움이 됩니다.';
            } else {
                return '무리하지 말고 충분한 휴식을 취하세요. 스트레스 관리와 명상이 도움이 될 것입니다.';
            }
        }
        
        // 행운 요소 생성
        function generateLuckyElements(saju, todayPillar) {
            const dayMaster = saju.dayPillar.stem;
            
            const timeMap = {
                '갑': '묘시 (05:00-07:00)', '을': '묘시 (05:00-07:00)',
                '병': '오시 (11:00-13:00)', '정': '사시 (09:00-11:00)',
                '무': '진시 (07:00-09:00)', '기': '미시 (13:00-15:00)',
                '경': '신시 (15:00-17:00)', '신': '유시 (17:00-19:00)',
                '임': '자시 (23:00-01:00)', '계': '해시 (21:00-23:00)'
            };
            
            const directionMap = {
                '목': '동쪽', '화': '남쪽', '토': '중앙', '금': '서쪽', '수': '북쪽'
            };
            
            const colorMap = {
                '목': '초록색, 청록색', '화': '빨간색, 보라색', '토': '노란색, 갈색',
                '금': '흰색, 은색', '수': '검은색, 파란색'
            };
            
            const numberMap = {
                '갑': '3, 8', '을': '3, 8', '병': '2, 7', '정': '2, 7',
                '무': '5, 10', '기': '5, 10', '경': '4, 9', '신': '4, 9',
                '임': '1, 6', '계': '1, 6'
            };
            
            const FIVE_ELEMENTS = {
                '갑': '목', '을': '목', '병': '화', '정': '화', '무': '토',
                '기': '토', '경': '금', '신': '금', '임': '수', '계': '수'
            };
            
            return {
                luckyTime: timeMap[dayMaster],
                luckyDirection: directionMap[FIVE_ELEMENTS[dayMaster]],
                luckyColor: colorMap[FIVE_ELEMENTS[dayMaster]],
                luckyNumber: numberMap[dayMaster]
            };
        }
        
        // 조언 생성
        function generateAdvice(saju, todayPillar, relation) {
            const dayMaster = saju.dayPillar.stem;
            const FIVE_ELEMENTS = {
                '갑': '목', '을': '목', '병': '화', '정': '화', '무': '토',
                '기': '토', '경': '금', '신': '금', '임': '수', '계': '수'
            };
            const element = FIVE_ELEMENTS[dayMaster];
            
            let mainAdvice = '';
            
            if (relation.specialRelation.type === '육합') {
                mainAdvice = `오늘은 육합의 조화로운 기운이 가득한 날입니다. ${dayMaster}일주인 당신의 장점이 최대한 발휘될 수 있으니, 평소 미뤄왔던 중요한 일을 진행해보세요.`;
            } else if (relation.specialRelation.type === '충') {
                mainAdvice = `충의 변화 에너지가 강한 날입니다. 예상치 못한 상황이 발생할 수 있지만, 이는 새로운 기회가 될 수도 있습니다.`;
            } else {
                mainAdvice = `${element}의 특성을 살려 차분하고 신중하게 하루를 보내세요. 큰 변화보다는 일상의 소중함을 느끼며 내적 성장에 집중하는 것이 좋겠습니다.`;
            }
            
            const doList = {
                '목': '새로운 프로젝트 시작',
                '화': '프레젠테이션이나 발표',
                '토': '계획 수립과 정리',
                '금': '중요한 결정',
                '수': '학습과 연구'
            };
            
            const dontList = {
                '목': '고집스러운 태도',
                '화': '과도한 열정',
                '토': '우유부단함',
                '금': '융통성 부족',
                '수': '책임 회피'
            };
            
            return {
                advice: mainAdvice,
                doAdvice: doList[element],
                dontAdvice: dontList[element]
            };
        }
        
        // 점수에 따른 색상
        function getScoreColor(score) {
            if (score >= 85) return '#10b981';
            if (score >= 70) return '#3b82f6';
            if (score >= 55) return '#f59e0b';
            return '#ef4444';
        }
        
        // 카카오톡 공유 기능 (수정됨)
        function shareFortune() {
            if (typeof Kakao !== 'undefined' && currentFortuneData) {
                const { userName, saju, fortune, today } = currentFortuneData;
                const dayMaster = saju.dayPillar.stem + saju.dayPillar.branch;
                
                const detailedDescription = `🔮 ${userName}님의 ${today.getFullYear()}년 ${today.getMonth() + 1}월 ${today.getDate()}일 운세

💫 총운: ${fortune.overallScore}점 | ❤️ 애정운: ${fortune.loveScore}점
💰 금전운: ${fortune.moneyScore}점 | 🏃 건강운: ${fortune.healthScore}점

⭐ 사주: ${dayMaster}일주
🌟 ${fortune.overallFortune}

🍀 행운 요소
⏰ 시간: ${fortune.luckyTime}
🧭 방향: ${fortune.luckyDirection}
🎨 색상: ${fortune.luckyColor}
🔢 숫자: ${fortune.luckyNumber}

만세력 기반 정확한 사주 운세 확인하기 👇`;
                
                Kakao.Share.sendDefault({
                    objectType: 'feed',
                    content: {
                        title: `🔮 ${userName}님의 오늘 운세 - ${dayMaster}일주`,
                        description: detailedDescription,
                        imageUrl: 'https://doha.kr/images/og-default.png',
                        link: {
                            mobileWebUrl: window.location.href,
                            webUrl: window.location.href,
                        },
                    },
                    buttons: [
                        {
                            title: '나도 운세 보기',
                            link: {
                                mobileWebUrl: 'https://doha.kr/fortune/daily/',
                                webUrl: 'https://doha.kr/fortune/daily/'
                            }
                        }
                    ]
                });
            } else {
                copyResultLink();
            }
        }
        
        // 링크 복사
        function copyResultLink() {
            const url = window.location.href;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(url).then(() => {
                    alert('링크가 복사되었습니다!');
                }).catch(() => {
                    alert('링크 복사에 실패했습니다.');
                });
            } else {
                alert('링크 복사에 실패했습니다.');
            }
        }
    </script>
    
    <!-- AdSense initialization -->
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</body>
</html>